import{s as J,u as G,aj as Z}from"./rpcWorker-X0469dqW.js";import{d as L,f as a,g as N,a as Q}from"./drawPhased-C_dsxJab.js";async function ee({ctx:o,canvasWidth:b,canvasHeight:F,renderArgs:I}){const{renderingMode:O,minorAlleleFrequencyFilter:U,sources:d,features:V,stopToken:T,lengthCutoffFilter:X}=I,{statusCallback:z=()=>{}}=I,r=F/d.length;J.checkStopToken(T);const g=await G.updateStatus("Calculating stats",z,()=>Z({stopToken:T,features:V.values(),minorAlleleFrequencyFilter:U,lengthCutoffFilter:X}));J.checkStopToken(T);const B=[],Y=g.length,u=b/Y;return await G.updateStatus("Drawing variant matrix",z,()=>{const w={};G.forEachWithStopTokenCheck(g,T,({feature:$,mostFrequentAlt:v},H)=>{var j,E,M;const R=[];if((j=$.get("FORMAT"))===null||j===void 0?void 0:j.includes("PS")){const _=$.get("samples"),c=H/g.length*b,k=d.length;for(let s=0;s<k;s++){const i=s/k*F,{name:D,HP:K}=d[s],e=_[D];if(e){const n=(E=e.GT)===null||E===void 0?void 0:E[0];if(n){R.push(n);const h=n.includes("|");if(O==="phased")if(h){const l=(M=e.PS)===null||M===void 0?void 0:M[0],t=n.split("|");L(t,o,c,i,u,r,K,l)}else o.fillStyle="black",o.fillRect(c-a,i-a,u+a,r+a);else{const l=`${n}:${v}`;let t=w[l];if(t===void 0){let m=0,y=0,S=0,P=0;const C=n.split(/[/|]/),p=C.length;for(let f=0;f<p;f++){const A=C[f];A===v?m++:A==="0"?P++:A==="."?y++:S++}t=N(P,m,S,y,p,!0),w[l]=t}t&&Q(t,o,c,i,u,r)}}}}}else{const _=$.get("genotypes"),c=H/g.length*b,k=d.length;for(let s=0;s<k;s++){const i=s/k*F,{name:D,HP:K}=d[s],e=_[D];if(e){R.push(e);const n=e.includes("|");if(O==="phased")if(n){const h=e.split("|");L(h,o,c,i,u,r,K)}else o.fillStyle="black",o.fillRect(c-a,i-a,u+a,r+a);else{const h=`${e}:${v}`;let l=w[h];if(l===void 0){let t=0,m=0,y=0,S=0;const P=e.split(/[/|]/),C=P.length;for(let p=0;p<C;p++){const f=P[p];f===v?t++:f==="0"?S++:f==="."?m++:y++}l=N(S,t,y,m,C,!0),w[h]=l}l&&Q(l,o,c,i,u,r)}}}}B.push(R)})}),{mafs:g,arr:B}}export{ee as makeImageData};
//# sourceMappingURL=makeImageData-CnAHsPJr.js.map
