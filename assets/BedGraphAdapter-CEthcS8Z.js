import{I as F}from"./main-BANj1I0n.js";import{B as w}from"./index-DYe7vadA.js";import{u as m,i as x}from"./rpcWorker-X0469dqW.js";import{p as L}from"./parseLineByLine-B_OL93YM.js";import{r as D}from"./rxjs-DQbUCOsY.js";class A extends w.BaseFeatureDataAdapter{constructor(){super(...arguments),this.intervalTrees={}}async getNames(){const{header:e,columnNames:t}=await this.loadData();if(t.length)return t;const s=e.split(/\n|\r\n|\r/).filter(a=>!!a).at(-1);return s!=null&&s.includes("	")?s.slice(1).split("	").map(a=>a.trim()):void 0}async loadFeatureIntervalTreeHelper(e){var t;const{features:i}=await this.loadData(),s=i[e];if(!s)return;const a=((t=await this.getNames())===null||t===void 0?void 0:t.slice(3))||[],o=new F;for(let r=0,n=s.length;r<n;r++){const d=s[r],[c,v,b,...u]=d.split("	");for(let l=0,g=u.length;l<g;l++){const T=`${this.id}-${c}-${r}-${l}`,h=+v,f=+b,p=+u[l],y=a[l]||`col${l}`;p&&o.insert([h,f],new m.SimpleFeature({id:T,data:{refName:c,start:h,end:f,score:p,source:y}}))}}return o}async getRefNames(e={}){const{features:t}=await this.loadData(e);return Object.keys(t)}async loadDataP(e={}){const t=this.pluginManager,i=this.getConf("bedGraphLocation"),s=await m.fetchAndMaybeUnzip(x.openLocation(i,t),e),a={},o=[];L.parseLineByLine(s,n=>{if(n.startsWith("#"))o.push(n);else{const d=n.indexOf("	"),c=n.slice(0,d);a[c]||(a[c]=[]),a[c].push(n)}return!0},e.statusCallback);const r=this.getConf("columnNames");return{header:o.join(`
`),features:a,columnNames:r}}async loadFeatureIntervalTree(e){return this.intervalTrees[e]||(this.intervalTrees[e]=this.loadFeatureIntervalTreeHelper(e).catch(t=>{throw this.intervalTrees[e]=void 0,t})),this.intervalTrees[e]}async loadData(e={}){return this.bedFeatures||(this.bedFeatures=this.loadDataP(e).catch(t=>{throw this.bedFeatures=void 0,t})),this.bedFeatures}getFeatures(e,t={}){return D.ObservableCreate(async i=>{const{start:s,end:a,refName:o}=e,r=await this.loadFeatureIntervalTree(o);for(const n of(r==null?void 0:r.search([s,a]))||[])i.next(n);i.complete()})}}export{A as default};
//# sourceMappingURL=BedGraphAdapter-CEthcS8Z.js.map
