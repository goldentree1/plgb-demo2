import{W as L,j as e,u as F,s as O,o as T,a as c,c as q,D,d as I,F as M,T as _,e as G,B as j,bw as W,aX as z,aW as B,m as H}from"./index-DUxFddIG.js";import{F as N}from"./FormControlLabel-ClCs1Dm_.js";import{C as R}from"./Checkbox-B2cvj8Wt.js";var f={},k;function P(){if(k)return f;k=1,Object.defineProperty(f,"__esModule",{value:!0}),f.formatFastaLines=s,f.formatSeqFasta=a;function s(n){return n.replaceAll(/(.{1,80})/g,`$1
`).trimEnd()}function a(n){return n.map(o=>`>${o.header}
${s(o.seq)}`).join(`
`)}return f}var V=P();const X=L(e.jsx("path",{d:"M19 9h-4V3H9v6H5l7 7zM5 18v2h14v-2z"}));async function J(s,a){const n=F.getSession(s),{leftOffset:o,rightOffset:m}=s;if(!o||!m)throw new Error("no offsets on model to use for range");if(new Set(a.map(b=>b.assemblyName)).size>1)throw new Error("not able to fetch sequences from multiple assemblies currently");const{rpcManager:x,assemblyManager:i}=n,g=o.assemblyName||m.assemblyName||"",p=i.get(g);if(!p)throw new Error(`assembly ${g} not found`);const h=O.getConf(p,["sequence","adapter"]),l="getSequence";return x.call(l,"CoreGetFeatures",{adapterConfig:h,regions:a,sessionId:l})}const K=H()({dialogContent:{width:"80em"},textAreaFont:{fontFamily:"Courier New"},ml:{marginLeft:10}}),Z=T(function({model:s,handleClose:a}){const{classes:n}=K(),[o,m]=c.useState(),[d,x]=c.useState(),[i,g]=c.useState(!1),[p,h]=c.useState(!1),[l,b]=c.useState(!1),{leftOffset:w,rightOffset:E}=s,S=d===void 0;c.useEffect(()=>{const r=new AbortController;return(async()=>{try{const t=s.getSelectedRegions(w,E);if(t.length===0)throw new Error("Selected region is out of bounds");x(await J(s,t))}catch(t){console.error(t),m(t)}})(),()=>{r.abort()}},[s,w,E]);const u=d?V.formatSeqFasta(d.map(r=>{let t=r.get("seq");const $=r.get("refName"),C=r.get("start")+1,v=r.get("end"),A=`${$}:${C}-${v}`;if((t==null?void 0:t.length)!==v-C+1)throw new Error(`${A} returned ${t.length.toLocaleString()} bases, but should have returned ${(v-C).toLocaleString()}`);return i&&(t=F.reverse(t)),l&&(t=F.complement(t)),{header:A+(i?"-rev":"")+(l?"-comp":""),seq:t}})):"",y=u?u.length>1e6:!1;return e.jsxs(q.Dialog,{maxWidth:"xl",open:!0,onClose:()=>{a(),s.setOffsets()},title:"Reference sequence",children:[e.jsxs(D,{children:[o?e.jsx(q.ErrorMessage,{error:o}):S?e.jsx(q.LoadingEllipses,{message:"Retrieving sequences"}):null,e.jsx(I,{"data-testid":"rubberband-sequence",variant:"outlined",multiline:!0,minRows:5,maxRows:10,disabled:y,className:n.dialogContent,fullWidth:!0,value:y?"Reference sequence too large to display, use the download FASTA button":u,slotProps:{input:{readOnly:!0,classes:{input:n.textAreaFont}}}}),e.jsxs(M,{children:[e.jsx(N,{control:e.jsx(R,{value:i,onChange:r=>{g(r.target.checked)}}),label:"Reverse sequence"}),e.jsx(N,{control:e.jsx(R,{value:l,onChange:r=>{b(r.target.checked)}}),label:"Complement sequence"})]}),e.jsx(_,{style:{margin:10},children:'Note: Check both boxes for the "reverse complement"'})]}),e.jsxs(G,{children:[e.jsx(j,{onClick:()=>{z(u),h(!0),setTimeout(()=>{h(!1)},500)},disabled:S||!!o||y,color:"primary",startIcon:e.jsx(W,{}),children:p?"Copied":"Copy to clipboard"}),e.jsx(j,{onClick:()=>{B.saveAs(new Blob([u||""],{type:"text/x-fasta;charset=utf-8"}),"jbrowse_ref_seq.fa")},disabled:S||!!o,color:"primary",startIcon:e.jsx(X,{}),children:"Download FASTA"}),e.jsx(j,{onClick:a,variant:"contained",children:"Close"})]})]})});export{Z as default};
//# sourceMappingURL=GetSequenceDialog-DJloud7Y.js.map
