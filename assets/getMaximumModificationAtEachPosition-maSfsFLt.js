import{u as B,bs as C,bt as y,bu as E}from"./index-DUxFddIG.js";function A(s,i){let o=0,n=0,t=0;const f=[];for(let l=0;l<s.length&&t<i.length;l+=2){const r=+s[l],e=s[l+1];if(e==="S"||e==="I"){for(let c=0;c<r&&t<i.length;c++)i[t]===o+c&&t++;o+=r}else if(e==="D"||e==="N")n+=r;else if(e==="M"||e==="X"||e==="="){for(let c=0;c<r&&t<i.length;c++)i[t]===o+c&&(f.push({ref:n+c,idx:t}),t++);o+=r,n+=r}}return f}function I(s,i,o){const n=o===-1?B.revcom(i):i,t=n.length,f=s.split(";"),l=[];for(const r of f){if(r==="")continue;const e=r.split(","),c=e[0],b=C.exec(c);if(!b)throw new Error(`bad format for MM tag: "${r}"`);const[,p,h,M]=b,a=M.split(/(\d+|.)/);for(const g of a){if(g==="")continue;const m=e.length;let d=0;const u=o===-1?new Array(m-1):[];let x=o===-1?m-2:0;for(let P=1;P<m;P++){let q=+e[P];do(p==="N"||p===n[d])&&q--,d++;while(q>=0&&d<t);if(o===-1){const w=t-d;w>=0&&(u[x--]=w)}else u[x++]=d-1}const v=o===-1?u.slice(x+1):u;l.push({type:g,base:p,strand:h,positions:v})}}return l}function R(s){const i=y(s,"ML","Ml")||[];if(i){const o=[];if(typeof i=="string"){const n=i.split(",");for(let t=0,f=n.length;t<f;t++)o.push(+n[t]/255)}else for(let n=0,t=i.length;n<t;n++)o.push(i[n]/255);return o}else{const o=y(s,"MP","Mp");if(o){const n=[];for(let t=0,f=o.length;t<f;t++){const l=o.charCodeAt(t)-33;n.push(Math.min(1,l/50))}return n}return}}function N(s,i){const o=s.get("start"),n=s.get("end"),t=s.get("strand"),f=n-o,l=y(s,"MM","Mm")||"",r=[],e=[],c=[],b=[],p=s.get("seq");if(p){const h=R(s),M=I(l,p,t);let a=0;for(const{type:g,positions:m}of M){for(const{ref:d,idx:u}of A(i,m)){if(d<0||d>=f)continue;const v=a+(t===-1?m.length-1-u:u),P=(h==null?void 0:h[v])||0;g==="m"?(r[d]=1,c[d]=P):g==="h"&&(e[d]=1,b[d]=P)}a+=m.length}}return{methBins:r,hydroxyMethBins:e,methProbs:c,hydroxyMethProbs:b}}function S(s,i){const o=s.get("strand"),n=s.get("seq"),t=y(s,"MM","Mm")||"",f=i||E(s.get("CIGAR"));if(n){const l=I(t,n,o),r=R(s),e=[];let c=0;for(const{type:b,positions:p}of l){for(const{ref:h,idx:M}of A(f,p)){const a=(r==null?void 0:r[c+(o===-1?p.length-1-M:M)])||0;if(!e[h])e[h]={type:b,prob:a,allProbs:[a]};else{const g=e[h];e[h]={allProbs:[...g.allProbs,a],prob:Math.max(g.prob,a),type:g.prob>a?g.type:b}}}c+=p.length}return e}}export{N as a,I as b,R as c,A as d,S as g};
//# sourceMappingURL=getMaximumModificationAtEachPosition-maSfsFLt.js.map
