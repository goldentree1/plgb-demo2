function d(c){return(typeof c=="object"&&c!==null&&"message"in c?c.message:`${c}`).replace(/\.$/,"")}class l{constructor(e,t={}){this.baseOverrides={},this.url=e;const s=t.fetch||globalThis.fetch.bind(globalThis);t.overrides&&(this.baseOverrides=t.overrides),this.fetchImplementation=s}async fetch(e,t){const s=i=>new Error(`${d(i)} fetching ${e}`,{cause:i});let a;try{a=await this.fetchImplementation(e,t)}catch(i){if(`${i}`.includes("Failed to fetch")){console.warn(`generic-filehandle: refetching ${e} to attempt to work around chrome CORS header caching bug`);try{a=await this.fetchImplementation(e,{...t,cache:"reload"})}catch(n){throw s(n)}}else throw s(i)}return a}async read(e,t,s={}){if(e===0)return new Uint8Array(0);const{headers:a={},signal:i,overrides:n={}}=s;e<1/0?a.range=`bytes=${t}-${t+e-1}`:e===1/0&&t!==0&&(a.range=`bytes=${t}-`);const r=await this.fetch(this.url,{...this.baseOverrides,...n,headers:{...this.baseOverrides.headers,...n.headers,...a},method:"GET",redirect:"follow",mode:"cors",signal:i});if(!r.ok)throw new Error(`HTTP ${r.status} fetching ${this.url}`);if(r.status===200&&t===0||r.status===206){const f=r.headers.get("content-range"),h=/\/(\d+)$/.exec(f||"");h!=null&&h[1]&&(this._stat={size:parseInt(h[1],10)});const o=r.bytes?await r.bytes():new Uint8Array(await r.arrayBuffer());return o.byteLength<=e?o:o.subarray(0,e)}throw new Error(r.status===200?`${this.url} fetch returned status 200, expected 206`:`HTTP ${r.status} fetching ${this.url}`)}async readFile(e={}){let t,s;if(typeof e=="string")t=e,s={};else{t=e.encoding;const{encoding:f,...h}=e;s=h}const{headers:a={},signal:i,overrides:n={}}=s,r=await this.fetch(this.url,{...this.baseOverrides,...n,headers:{...this.baseOverrides.headers,...n.headers,...a},method:"GET",redirect:"follow",mode:"cors",signal:i});if(!r.ok)throw new Error(`HTTP ${r.status} fetching ${this.url}`);if(t==="utf8")return r.text();if(t)throw new Error(`unsupported encoding: ${t}`);return r.bytes?r.bytes():new Uint8Array(await r.arrayBuffer())}async stat(){if(!this._stat&&(await this.read(10,0),!this._stat))throw new Error(`unable to determine size of file at ${this.url}`);return this._stat}async close(){}}export{l as R};
//# sourceMappingURL=remoteFile-B4_2tkev.js.map
