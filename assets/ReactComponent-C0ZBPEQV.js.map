{"version":3,"file":"ReactComponent-C0ZBPEQV.js","sources":["../../node_modules/@jbrowse/plugin-alignments/esm/LinearReadCloudDisplay/components/ReactComponent.js"],"sourcesContent":["import { jsx as _jsx, jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { useCallback, useMemo, useRef, useState } from 'react';\nimport BaseTooltip from '@jbrowse/core/ui/BaseTooltip';\nimport { getContainingView } from '@jbrowse/core/util';\nimport Flatbush from '@jbrowse/core/util/flatbush';\nimport { observer } from 'mobx-react';\nimport BaseDisplayComponent from '../../shared/components/BaseDisplayComponent';\nconst Cloud = observer(function ({ model, }) {\n    const view = getContainingView(model);\n    const width = Math.round(view.dynamicBlocks.totalWidthPx);\n    const height = model.drawCloud ? model.height : model.layoutHeight;\n    const containerRef = useRef(null);\n    const [hoveredFeature, setHoveredFeature] = useState(null);\n    const [hoveredFeatureData, setHoveredFeatureData] = useState(null);\n    const [mousePosition, setMousePosition] = useState(null);\n    const flatbushIndex = useMemo(() => {\n        return model.featureLayout ? Flatbush.from(model.featureLayout.data) : null;\n    }, [model.featureLayout]);\n    const cb = useCallback((ref) => {\n        model.setRef(ref);\n    }, [model, width, height]);\n    const mouseoverCb = useCallback((ref) => {\n        model.setMouseoverRef(ref);\n    }, [model, width, height]);\n    const onMouseMove = useCallback((event) => {\n        if (!containerRef.current || !flatbushIndex) {\n            setHoveredFeature(null);\n            setHoveredFeatureData(null);\n            setMousePosition(null);\n            return;\n        }\n        const rect = containerRef.current.getBoundingClientRect();\n        const offsetX = event.clientX - rect.left;\n        const offsetY = event.clientY - rect.top;\n        setMousePosition({ x: event.clientX, y: event.clientY });\n        const results = flatbushIndex.search(offsetX, offsetY, offsetX + 1, offsetY + 1);\n        if (results.length > 0) {\n            const featureIndex = results[0];\n            const feature = model.featuresForFlatbush[featureIndex];\n            if (feature) {\n                setHoveredFeature({\n                    x: feature.chainMinX,\n                    y: feature.y1,\n                    width: feature.chainMaxX - feature.chainMinX,\n                    height: feature.y2 - feature.y1,\n                });\n                setHoveredFeatureData(feature.data);\n            }\n            else {\n                setHoveredFeature(null);\n                setHoveredFeatureData(null);\n            }\n        }\n        else {\n            setHoveredFeature(null);\n            setHoveredFeatureData(null);\n        }\n    }, [flatbushIndex, model.featuresForFlatbush]);\n    const onMouseLeave = useCallback(() => {\n        setHoveredFeature(null);\n        setHoveredFeatureData(null);\n        setMousePosition(null);\n    }, []);\n    const onClick = useCallback((event) => {\n        if (!containerRef.current || !flatbushIndex) {\n            return;\n        }\n        const rect = containerRef.current.getBoundingClientRect();\n        const offsetX = event.clientX - rect.left;\n        const offsetY = event.clientY - rect.top;\n        const results = flatbushIndex.search(offsetX, offsetY, offsetX + 1, offsetY + 1);\n        if (results.length > 0) {\n            const featureIndex = results[0];\n            const feature = model.featuresForFlatbush[featureIndex];\n            if (feature) {\n                model.selectFeature(feature.chain);\n            }\n        }\n    }, [flatbushIndex, model]);\n    return (_jsxs(\"div\", { ref: containerRef, style: { position: 'relative', width, height }, onMouseMove: onMouseMove, onMouseLeave: onMouseLeave, onClick: onClick, children: [_jsx(\"canvas\", { \"data-testid\": model.drawCloud ? 'cloud-canvas' : 'stack-canvas', ref: cb, style: { width, height, position: 'absolute', left: 0, top: 0 }, width: width * 2, height: height * 2 }), _jsx(\"canvas\", { \"data-testid\": \"cloud-mouseover-canvas\", ref: mouseoverCb, style: {\n                    width,\n                    height,\n                    position: 'absolute',\n                    left: 0,\n                    top: 0,\n                    pointerEvents: 'none',\n                }, width: width * 2, height: height * 2 }), hoveredFeature ? (_jsx(\"div\", { style: {\n                    position: 'absolute',\n                    left: hoveredFeature.x,\n                    top: hoveredFeature.y,\n                    width: hoveredFeature.width,\n                    height: hoveredFeature.height,\n                    backgroundColor: 'rgba(0, 0, 0, 0.2)',\n                    pointerEvents: 'none',\n                } })) : null, hoveredFeatureData && mousePosition ? (_jsx(BaseTooltip, { clientPoint: { x: mousePosition.x, y: mousePosition.y + 20 }, placement: \"bottom-start\", children: _jsxs(\"div\", { children: [_jsx(\"div\", { children: _jsx(\"strong\", { children: hoveredFeatureData.name }) }), _jsxs(\"div\", { children: [hoveredFeatureData.refName, \":\", hoveredFeatureData.start.toLocaleString(), \"-\", hoveredFeatureData.end.toLocaleString()] }), hoveredFeatureData.tlen !== 0 ? (_jsxs(\"div\", { children: [\"Template length: \", hoveredFeatureData.tlen] })) : null] }) })) : null] }));\n});\nconst LinearReadCloudReactComponent = observer(function ({ model, }) {\n    return (_jsx(BaseDisplayComponent, { model: model, children: _jsx(Cloud, { model: model }) }));\n});\nexport default LinearReadCloudReactComponent;\n"],"names":["Cloud","observer","model","view","getContainingView","width","height","containerRef","useRef","hoveredFeature","setHoveredFeature","useState","hoveredFeatureData","setHoveredFeatureData","mousePosition","setMousePosition","flatbushIndex","useMemo","Flatbush","cb","useCallback","ref","mouseoverCb","onMouseMove","event","rect","offsetX","offsetY","results","featureIndex","feature","onMouseLeave","onClick","_jsxs","_jsx","BaseTooltip","LinearReadCloudReactComponent","BaseDisplayComponent"],"mappings":"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","x_google_ignoreList":[0]}