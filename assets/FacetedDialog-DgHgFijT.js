import{o as S,r as M,j as e,b8 as E,J as N,bI as K,u as v,m as H,T as W,ak as k,bJ as R,bj as z,bK as T,bL as L,bM as D,bN as G,K as O,bO as $,bP as A,c as F,I as V}from"./rpcWorker-X0469dqW.js";import{S as y}from"./SanitizedHTML-Clz1F4j3.js";import{C as I}from"./Clear-CjGNtFzz.js";import{D as _}from"./DataGrid-CDeG2vOy.js";import{S as B,T as P}from"./HierarchicalTrackSelector-DRsHfZSG.js";import{G as U}from"./Grid-Cf8elzML.js";import"./getThemeProps-RNW6Z-3w.js";import"./FormControlLabel-1s92K5sy.js";import"./MenuItem-CxTol2m1.js";import"./dividerClasses-BkmUKgu8.js";import"./Divider-DsWTSitt.js";import"./Badge-BKK_x0o6.js";import"./TableCell-BPTDO_V-.js";import"./Checkbox-CZRpP34h.js";const J=H()(n=>({facet:{margin:0,marginLeft:n.spacing(2)},select:{marginBottom:n.spacing(2)}}));function q({onClick:n}){return e.jsx(W,{title:"Clear selection on this facet filter",children:e.jsx(k,{onClick:()=>{n()},size:"small",children:e.jsx(I,{})})})}function Q({visible:n,onClick:i}){return e.jsx(W,{title:"Minimize/expand this facet filter",children:e.jsx(k,{onClick:()=>{i()},size:"small",children:n?e.jsx(R,{}):e.jsx(z,{})})})}const X=S(function({column:n,vals:i,model:c}){const{classes:h}=J(),[u,m]=M.useState(!0),{faceted:f}=c,{filters:d}=f,{field:r}=n;return e.jsxs(E,{className:h.facet,fullWidth:!0,children:[e.jsxs("div",{children:[e.jsx(N,{component:"span",children:r}),e.jsx(q,{onClick:()=>{f.setFilter(r,[])}}),e.jsx(Q,{visible:u,onClick:()=>{m(!u)}})]}),u?e.jsx(K,{multiple:!0,native:!0,className:h.select,value:d.get(n.field)||[],onChange:l=>{f.setFilter(n.field,[...l.target.options].filter(p=>p.selected).map(p=>p.value))},children:i.sort((l,p)=>l[0].localeCompare(p[0])).map(([l,p])=>e.jsxs("option",{value:l,children:[v.coarseStripHTML(l)," (",p,")"]},l))}):null]})}),Y=S(function({rows:n,columns:i,model:c}){var h,u;const{faceted:m}=c,{filters:f}=m,d=i.slice(1),r=new Map(i.slice(1).map(s=>[s.field,new Map])),l=m.filters.keys(),p=d.map(s=>s.field),j=new Set;for(const s of l)!((h=f.get(s))===null||h===void 0)&&h.length&&j.add(s);for(const s of p)j.add(s);let o=n;for(const s of j){const a=r.get(s);if(a)for(const t of o){const x=T(s,t),C=a.get(x);x&&(C===void 0?a.set(x,1):a.set(x,C+1))}const g=!((u=f.get(s))===null||u===void 0)&&u.length?new Set(f.get(s)):void 0;o=o.filter(t=>g!==void 0?g.has(T(s,t)):!0)}return e.jsx("div",{children:d.map(s=>e.jsx(X,{vals:[...r.get(s.field)],column:s,model:c},s.field))})}),Z=S(function({model:n,columns:i,shownTrackIds:c,selection:h}){const{pluginManager:u}=v.getEnv(n),{view:m,faceted:f}=n,{rows:d,useShoppingCart:r,showOptions:l,filteredRows:p,filteredNonMetadataKeys:j,filteredMetadataKeys:o,visible:s}=f,[a,g]=M.useState({name:v.measureGridWidth(d.map(t=>t.name),{maxWidth:500,stripHTML:!0})+15,...Object.fromEntries(j.filter(t=>s[t]).map(t=>[t,v.measureGridWidth(d.map(x=>x[t]),{maxWidth:400,stripHTML:!0})])),...Object.fromEntries(o.filter(t=>s[`metadata.${t}`]).map(t=>[`metadata.${t}`,v.measureGridWidth(d.map(x=>x.metadata[t]),{maxWidth:400,stripHTML:!0})]))});return e.jsx(_,{rowHeight:25,columnHeaderHeight:35,checkboxSelection:!0,disableRowSelectionOnClick:!0,keepNonExistentRowsSelected:!0,rows:p,columnVisibilityModel:s,showToolbar:l,onColumnWidthChange:t=>{g({...a,[t.colDef.field]:t.width})},onColumnVisibilityModelChange:t=>{n.faceted.setVisible(t)},onRowSelectionModelChange:t=>{if(r){const x=D(n),C=u.pluggableConfigSchemaType("track");n.setSelection([...t.ids].map(w=>G(C,x,w)))}else{const x=c,C=t.ids;L(()=>{[...x].filter(w=>!C.has(w)).map(w=>m.hideTrack(w)),[...C].filter(w=>!x.has(w)).map(w=>{m.showTrack(w),n.addToRecentlyUsed(w)})})}},rowSelectionModel:{type:"include",ids:new Set(r?h.map(t=>t.trackId):[...c])},columns:i.map(t=>({...t,width:a[t.field]}))})});function ee({model:n}){const{faceted:i}=n,[c,h]=M.useState(null),{showOptions:u,showFilters:m,showSparse:f,useShoppingCart:d}=i;return e.jsxs(e.Fragment,{children:[e.jsxs(U,{container:!0,spacing:4,alignItems:"center",children:[e.jsx(O,{label:"Search...",value:i.filterText,onChange:r=>{i.setFilterText(r.target.value)},slotProps:{input:{endAdornment:e.jsx($,{position:"end",children:e.jsx(k,{onClick:()=>{i.setFilterText("")},children:e.jsx(I,{})})})}}}),e.jsx(k,{onClick:r=>{h(r.currentTarget)},children:e.jsx(A,{})}),e.jsx(B,{model:n})]}),e.jsx(F.Menu,{anchorEl:c,open:!!c,onClose:()=>{h(null)},onMenuItemClick:(r,l)=>{l(),h(null)},menuItems:[{label:"Add tracks to selection instead of turning them on/off",onClick:()=>{i.setUseShoppingCart(!d)},type:"checkbox",checked:d},{label:"Show sparse metadata columns",onClick:()=>{i.setShowSparse(!f)},checked:f,type:"checkbox"},{label:"Show facet filters",onClick:()=>{i.setShowFilters(!m)},checked:m,type:"checkbox"},{label:"Show extra table options",onClick:()=>{i.setShowOptions(!u)},checked:u,type:"checkbox"}]})]})}const te=H()({cell:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},resizeHandle:{marginLeft:5,background:"grey",width:5}}),b=.75,se=S(function({model:i}){const{classes:c}=te(),{selection:h,shownTrackIds:u,faceted:m}=i,{rows:f,panelWidth:d,showFilters:r,filteredNonMetadataKeys:l,filteredMetadataKeys:p}=m,j=[{field:"name",hideable:!1,renderCell:o=>{const{value:s,row:a}=o,{id:g,conf:t}=a;return e.jsxs("div",{className:c.cell,children:[e.jsx(y,{html:s}),e.jsx(P,{id:g,conf:t,trackId:g,model:i})]})}},...l.map(o=>({field:o,renderCell:s=>{const a=s.value;return a?e.jsx(y,{className:c.cell,html:a}):""}})),...p.map(o=>({field:`metadata.${o}`,headerName:["name",...l].includes(o)?`${o} (from metadata)`:o,valueGetter:(s,a)=>{var g;return`${(g=a.metadata[o])!==null&&g!==void 0?g:""}`},renderCell:s=>{const a=s.value;return a?e.jsx(y,{className:c.cell,html:a}):""}}))];return e.jsxs(e.Fragment,{children:[e.jsx(ee,{model:i}),e.jsxs("div",{style:{display:"flex",overflow:"hidden",height:window.innerHeight*b,width:window.innerWidth*b},children:[e.jsx("div",{style:{height:window.innerHeight*b,width:window.innerWidth*b-(r?d:0)},children:e.jsx(Z,{model:i,columns:j,shownTrackIds:u,selection:h})}),r?e.jsxs(e.Fragment,{children:[e.jsx(F.ResizeHandle,{vertical:!0,onDrag:o=>m.setPanelWidth(d-o),className:c.resizeHandle}),e.jsx("div",{style:{width:d,overflow:"auto"},children:e.jsx(Y,{model:i,rows:f,columns:j})})]}):null]})]})}),ge=S(function(n){const{handleClose:i}=n;return e.jsx(F.Dialog,{open:!0,onClose:i,maxWidth:"xl",title:"Faceted track selector",children:e.jsx(V,{children:e.jsx(se,{...n})})})});export{ge as default};
//# sourceMappingURL=FacetedDialog-DgHgFijT.js.map
