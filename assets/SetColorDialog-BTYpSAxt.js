import{a as b,j as e,B as c,bz as B,bA as F,bB as N,bC as P,u as k,c as H,m as y,D as O,T as I,d as U,e as T,bf as W}from"./index-DUxFddIG.js";import{C as K,a as z}from"./ColorPicker-FhTQzdFV.js";import{m as M,a as R}from"./util-D-QDnG1y.js";import{D as _}from"./DataGrid-C-pLz9P0.js";import{c as $,D as V}from"./index-gHGMdGta.js";import"./getThemeProps-Dm0Ny9BI.js";import"./FormControlLabel-ClCs1Dm_.js";import"./MenuItem-BgPyIMvW.js";import"./dividerClasses-Dak6ZOU3.js";import"./Divider-j7V_EdKn.js";import"./Badge-BJe6riUv.js";import"./TableCell-KTWXPZ0I.js";import"./Checkbox-B2cvj8Wt.js";const L=y()({cell:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}});function Y({rows:t,onChange:n,showTips:u}){const{classes:s}=L(),[h,p]=b.useState(null),[o,i]=b.useState([]),{name:g,color:a,source:C,baseUri:l,...m}=t.length>0?t[0]:{},[d,S]=b.useState("blue"),[x,G]=b.useState({idx:0,field:null});return e.jsxs("div",{children:[e.jsx(c,{disabled:!o.length,onClick:r=>{p(r.currentTarget)},children:"Change color of selected items"}),e.jsxs(c,{disabled:!o.length,onClick:()=>{n(M([...t],o))},children:[e.jsx(B,{}),u?"Move selected items up":null]}),e.jsxs(c,{disabled:!o.length,onClick:()=>{n(R([...t],o))},children:[e.jsx(F,{}),u?"Move selected items down":null]}),e.jsxs(c,{disabled:!o.length,onClick:()=>{n(M([...t],o,t.length))},children:[e.jsx(N,{}),u?"Move selected items to top":null]}),e.jsxs(c,{disabled:!o.length,onClick:()=>{n(R([...t],o,t.length))},children:[e.jsx(P,{}),u?"Move selected items to bottom":null]}),e.jsx(K.ColorPopover,{anchorEl:h,color:d,onChange:r=>{S(r);for(const f of o){const w=t.find(j=>j.name===f);w&&(w.color=r)}n([...t])},onClose:()=>{p(null)}}),e.jsx("div",{style:{height:400,width:"100%"},children:e.jsx(_,{disableRowSelectionOnClick:!0,getRowId:r=>r.name,checkboxSelection:!0,onRowSelectionModelChange:r=>{i([...r.ids])},rows:t,rowHeight:25,columnHeaderHeight:33,columns:[{field:"color",headerName:"Color",renderCell:({value:r,id:f})=>e.jsx(z,{color:r||"blue",onChange:w=>{const j=t.find(v=>v.name===f);j&&(j.color=w),n([...t])}})},{field:"name",headerName:"Name",width:k.measureGridWidth(t.map(r=>r.name))},...Object.keys(m).map(r=>({field:r,renderCell:({value:f})=>e.jsx("div",{className:s.cell,children:e.jsx(H.SanitizedHTML,{html:k.getStr(f)})}),width:k.measureGridWidth(t.map(f=>`${f[r]}`))}))],sortModel:[],onSortModelChange:r=>{const f=r[0],w=(x.idx+1)%2,j=f.field||x.field;G({idx:w,field:j}),n(j?[...t].sort((v,A)=>{const E=k.getStr(v[j]),D=k.getStr(A[j]);return w===1?E.localeCompare(D):D.localeCompare(E)}):t)}})})]})}const q=y()({textAreaFont:{fontFamily:"Courier New"}});function J({onClose:t,currLayout:n}){const{classes:u}=q(),[s,h]=b.useState(""),[p,o]=b.useState();return e.jsxs(e.Fragment,{children:[e.jsxs(O,{children:[e.jsx(I,{children:'Paste CSV or TSV. If a header column is present. First line is a header. If a column called "name" is present, it uses that to connect to IDs in the table, otherwise it uses the first column no.'}),p?e.jsx(H.ErrorMessage,{error:p}):null,e.jsx(U,{variant:"outlined",multiline:!0,minRows:5,placeholder:`name,population
HG00098,GBR
HG00101,GBR
HG00459,CHS
...`,maxRows:10,fullWidth:!0,value:s,onChange:i=>{h(i.target.value)},slotProps:{input:{classes:{input:u.textAreaFont}}}})]}),e.jsxs(T,{children:[e.jsx(c,{variant:"contained",color:"secondary",onClick:()=>{const i=s.split(`
`).map(a=>a.trim()).filter(a=>!!a),g=i[0].split(/[,\t]/gm);if(g.includes("name")){o("");const a=Object.fromEntries(n.map(l=>[l.name,l])),C=Object.fromEntries(i.slice(1).map(l=>{const m=l.split(/[,\t]/gm),d=Object.fromEntries(m.map((S,x)=>[g[x],S]));return[d.name,{...d,...a[d.name]}]}));t(n.map(l=>({...l,...C[l.name]})))}else o(new Error('No "name" column found on line 1'))},children:"Update rows"}),e.jsx(c,{variant:"contained",color:"primary",onClick:()=>{const i=s.split(`
`).map(a=>a.trim()).filter(a=>!!a),g=i[0].split(/[,\t]/gm);if(g.includes("name")){o("");const a=Object.fromEntries(n.map(l=>[l.name,l])),C=Object.fromEntries(i.slice(1).map(l=>{const m=l.split(/[,\t]/gm),d=Object.fromEntries(m.map((S,x)=>[g[x],S]));return[d.name,{...d,...a[d.name]}]}));t(n.map(l=>({...C[l.name]})))}else o(new Error('No "name" column found on line 1'))},children:"Replace rows"}),e.jsx(c,{variant:"contained",color:"inherit",onClick:()=>{t()},children:"Cancel"})]})]})}function Q(){return e.jsxs(e.Fragment,{children:["Helpful tips",e.jsxs("ul",{children:[e.jsx("li",{children:"You can select rows in the table with the checkboxes"}),e.jsx("li",{children:"Multi-select is enabled with shift-click and control-click"}),e.jsx("li",{children:'The "Move selected items up/down" can re-arrange subtracks'}),e.jsx("li",{children:"Sorting the data grid itself can also re-arrange subtracks"}),e.jsx("li",{children:"Changes are applied when you hit Submit"}),e.jsx("li",{children:"You can click and drag the dialog box to move it on the screen"}),e.jsx("li",{children:"Columns in the table can be hidden using a vertical '...' menu on the right side of each column"})]})]})}function X({setCurrLayout:t,currLayout:n}){if(!n.length||!n[0])return null;const u=Object.keys(n[0]).filter(s=>s!=="name"&&s!=="color"&&s!=="source"&&s!=="label"&&s!=="id"&&s!=="HP");return e.jsxs("div",{children:["Create color palette based on...",u.map(s=>e.jsx(c,{variant:"contained",color:"inherit",onClick:()=>{const h=new Map;for(const o of n){const i=h.get(o[s]);i?h.set(o[s],i+1):h.set(o[s],1)}const p=Object.fromEntries([...h.entries()].sort((o,i)=>o[1]-i[1]).map((o,i)=>[o[0],W.set1[i]||$.randomColor(o[0])]));t(n.map(o=>({...o,color:p[o[s]]})))},children:s},s)),e.jsx(c,{onClick:()=>{t(n.map(s=>({...s,color:void 0})))},children:"Clear colors"})]})}const Z=y()({content:{minWidth:800},fr:{float:"right",display:"flex",gap:8}});function ee({model:t,handleClose:n,title:u="Color/arrangement editor",enableBulkEdit:s=!1,enableRowPalettizer:h=!1,showTipsStorageKey:p="setColorDialog-showTips",SourcesGridComponent:o}){const{classes:i}=Z(),{sources:g}=t,[a,C]=b.useState(!1),[l,m]=b.useState(structuredClone(g||[])),[d,S]=k.useLocalStorage(p,!1);return e.jsx(V,{open:!0,onClose:n,maxWidth:"xl",title:u,children:a&&s?e.jsx(J,{currLayout:l,onClose:x=>{x&&m(x),C(!1)}}):e.jsxs(e.Fragment,{children:[e.jsxs(O,{className:i.content,children:[e.jsxs("div",{className:i.fr,children:[e.jsx(c,{variant:"contained",onClick:()=>{S(!d)},children:d?"Hide tips":"Show tips"}),s?e.jsx(c,{color:"secondary",variant:"contained",onClick:()=>{C(!a)},children:"Show Bulk row editor"}):null]}),d?e.jsx(Q,{}):null,h?e.jsxs(e.Fragment,{children:[e.jsx("br",{}),e.jsx(X,{currLayout:l,setCurrLayout:m})]}):null,e.jsx(o,{rows:l,onChange:m,showTips:d})]}),e.jsxs(T,{children:[e.jsx(c,{variant:"contained",type:"submit",color:"inherit",onClick:()=>{t.clearLayout(),m(t.sources||[])},children:"Clear custom settings"}),e.jsx(c,{variant:"contained",color:"secondary",onClick:()=>{n(),m([...t.sources||[]])},children:"Cancel"}),e.jsx(c,{variant:"contained",color:"primary",type:"submit",onClick:()=>{t.setLayout(l),n()},children:"Submit"})]})]})})}function pe({model:t,handleClose:n}){return e.jsx(ee,{model:t,handleClose:n,title:"Multi-wiggle color/arrangement editor",enableBulkEdit:!0,enableRowPalettizer:!0,showTipsStorageKey:"multiwiggle-showTips",SourcesGridComponent:Y})}export{pe as default};
//# sourceMappingURL=SetColorDialog-BTYpSAxt.js.map
