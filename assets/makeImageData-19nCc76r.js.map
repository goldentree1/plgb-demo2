{"version":3,"file":"makeImageData-19nCc76r.js","sources":["../node_modules/@jbrowse/plugin-alignments/esm/PileupRenderer/colorBy.js","../node_modules/@jbrowse/plugin-alignments/esm/PileupRenderer/renderers/getAlignmentShapeColor.js","../node_modules/@jbrowse/plugin-alignments/esm/PileupRenderer/renderers/renderAlignmentShape.js","../node_modules/@jbrowse/plugin-alignments/esm/PileupRenderer/util.js","../node_modules/@jbrowse/plugin-alignments/esm/PileupRenderer/renderers/renderMethylation.js","../node_modules/@jbrowse/plugin-alignments/esm/PileupRenderer/renderers/renderModifications.js","../node_modules/@jbrowse/plugin-alignments/esm/PileupRenderer/renderers/renderPerBaseLettering.js","../node_modules/@jbrowse/plugin-alignments/esm/PileupRenderer/renderers/renderPerBaseQuality.js","../node_modules/@jbrowse/plugin-alignments/esm/PileupRenderer/renderers/renderAlignment.js","../node_modules/@jbrowse/plugin-alignments/esm/PileupRenderer/renderers/renderMismatches.js","../node_modules/@jbrowse/plugin-alignments/esm/PileupRenderer/renderers/renderSoftClipping.js","../node_modules/@jbrowse/plugin-alignments/esm/PileupRenderer/makeImageData.js"],"sourcesContent":["import { readConfObject } from '@jbrowse/core/configuration';\nimport { fillColor } from '../shared/color';\nimport { orientationTypes } from '../util';\nexport function colorByInsertSize(feature) {\n    return feature.get('is_paired') &&\n        feature.get('refName') !== feature.get('next_ref')\n        ? '#555'\n        : `hsl(${Math.abs(feature.get('template_length')) / 10},50%,50%)`;\n}\nexport function colorByMappingQuality(feature) {\n    return `hsl(${feature.get('score')},50%,50%)`;\n}\nfunction getOrientation(feature, config) {\n    const orientationType = readConfObject(config, 'orientationType');\n    const type = orientationTypes[orientationType];\n    const orientation = type[feature.get('pair_orientation')];\n    return {\n        LR: 'color_pair_lr',\n        RR: 'color_pair_rr',\n        RL: 'color_pair_rl',\n        LL: 'color_pair_ll',\n    }[orientation];\n}\nexport function colorByStrand(feature) {\n    return feature.get('strand') === -1 ? '#8F8FD8' : '#EC8B8B';\n}\nexport function colorByOrientation(feature, config) {\n    return fillColor[getOrientation(feature, config) || 'color_nostrand'];\n}\nfunction getStranded(feature) {\n    const flags = feature.get('flags');\n    const strand = feature.get('strand');\n    if (flags & 1) {\n        const flipper = flags & 64 ? -1 : 1;\n        if (flags & 2) {\n            return strand * flipper === 1 ? 'color_rev_strand' : 'color_fwd_strand';\n        }\n        if (flags & 8) {\n            return strand * flipper === 1\n                ? 'color_rev_missing_mate'\n                : 'color_fwd_missing_mate';\n        }\n        if (feature.get('refName') === feature.get('next_ref')) {\n            return strand * flipper === 1\n                ? 'color_rev_strand_not_proper'\n                : 'color_fwd_strand_not_proper';\n        }\n        return strand === 1 ? 'color_fwd_diff_chr' : 'color_rev_diff_chr';\n    }\n    return 'color_unknown';\n}\nexport function colorByStrandedRnaSeq(feature) {\n    return fillColor[getStranded(feature)];\n}\n","import { readConfObject } from '@jbrowse/core/configuration';\nimport { fillColor } from '../../shared/color';\nimport { colorByInsertSize, colorByMappingQuality, colorByOrientation, colorByStrand, colorByStrandedRnaSeq, } from '../colorBy';\nexport function getAlignmentShapeColor({ colorType, tag, feature, config, defaultColor, colorTagMap, }) {\n    switch (colorType) {\n        case 'insertSize':\n            return colorByInsertSize(feature);\n        case 'strand':\n            return colorByStrand(feature);\n        case 'mappingQuality':\n            return colorByMappingQuality(feature);\n        case 'pairOrientation':\n            return colorByOrientation(feature, config);\n        case 'stranded':\n            return colorByStrandedRnaSeq(feature);\n        case 'xs':\n        case 'tag': {\n            const tags = feature.get('tags');\n            const val = tags ? tags[tag] : feature.get(tag);\n            if (tag === 'XS' || tag === 'TS') {\n                if (val === '-') {\n                    return fillColor.color_rev_strand;\n                }\n                else if (val === '+') {\n                    return fillColor.color_fwd_strand;\n                }\n                else {\n                    return fillColor.color_nostrand;\n                }\n            }\n            if (tag === 'ts') {\n                if (val === '-') {\n                    return feature.get('strand') === -1\n                        ? fillColor.color_fwd_strand\n                        : fillColor.color_rev_strand;\n                }\n                else if (val === '+') {\n                    return feature.get('strand') === -1\n                        ? fillColor.color_rev_strand\n                        : fillColor.color_fwd_strand;\n                }\n                else {\n                    return fillColor.color_nostrand;\n                }\n            }\n            return colorTagMap[val] || fillColor.color_nostrand;\n        }\n        case 'insertSizeAndPairOrientation':\n            break;\n        case 'modifications':\n        case 'methylation':\n            return feature.get('flags') & 16 ? '#c8dcc8' : '#c8c8c8';\n        default:\n            return defaultColor\n                ? 'lightgrey'\n                : readConfObject(config, 'color', { feature });\n    }\n}\n","import { bpSpanPx } from '@jbrowse/core/util';\nimport { parseCigar } from '../../MismatchParser';\nexport function renderAlignmentShape({ ctx, feat, renderArgs, }) {\n    const { regions, bpPerPx } = renderArgs;\n    const { heightPx, topPx, feature } = feat;\n    const region = regions[0];\n    const s = feature.get('start');\n    const e = feature.get('end');\n    const CIGAR = feature.get('CIGAR');\n    const flip = region.reversed ? -1 : 1;\n    const strand = feature.get('strand') * flip;\n    const renderChevrons = bpPerPx < 10 && heightPx > 5;\n    if (CIGAR === null || CIGAR === void 0 ? void 0 : CIGAR.includes('N')) {\n        const cigarOps = parseCigar(CIGAR);\n        if (strand === 1) {\n            let drawLen = 0;\n            let drawStart = s;\n            for (let i = 0; i < cigarOps.length; i += 2) {\n                const opLen = +cigarOps[i];\n                const op = cigarOps[i + 1];\n                if (op === 'M' || op === 'X' || op === '=' || op === 'D') {\n                    drawLen += opLen;\n                }\n                else if (op === 'N') {\n                    if (drawStart !== drawLen) {\n                        const [leftPx, rightPx] = bpSpanPx(drawStart, drawStart + drawLen, region, bpPerPx);\n                        const w = rightPx - leftPx;\n                        ctx.fillRect(leftPx, topPx, w, heightPx);\n                    }\n                    drawStart += drawLen + opLen;\n                    drawLen = 0;\n                }\n            }\n            if (drawStart !== drawLen) {\n                const [leftPx, rightPx] = bpSpanPx(drawStart, drawStart + drawLen, region, bpPerPx);\n                const w = rightPx - leftPx;\n                if (renderChevrons) {\n                    ctx.beginPath();\n                    ctx.moveTo(leftPx, topPx);\n                    ctx.lineTo(leftPx, topPx + heightPx);\n                    ctx.lineTo(rightPx, topPx + heightPx);\n                    ctx.lineTo(rightPx + 5, topPx + heightPx / 2);\n                    ctx.lineTo(rightPx, topPx);\n                    ctx.closePath();\n                    ctx.fill();\n                }\n                else {\n                    ctx.fillRect(leftPx, topPx, w, heightPx);\n                }\n            }\n        }\n        else if (strand === -1) {\n            let drawLen = 0;\n            let drawStart = e;\n            for (let i = cigarOps.length - 2; i >= 0; i -= 2) {\n                const opLen = +cigarOps[i];\n                const op = cigarOps[i + 1];\n                if (op === 'M' || op === 'X' || op === '=' || op === 'D') {\n                    drawLen += opLen;\n                }\n                else if (op === 'N') {\n                    if (drawLen !== 0) {\n                        const [leftPx, rightPx] = bpSpanPx(drawStart - drawLen, drawStart, region, bpPerPx);\n                        ctx.fillRect(leftPx, topPx, rightPx - leftPx, heightPx);\n                    }\n                    drawStart -= drawLen + opLen;\n                    drawLen = 0;\n                }\n            }\n            if (drawLen !== 0) {\n                const [leftPx, rightPx] = bpSpanPx(drawStart - drawLen, drawStart, region, bpPerPx);\n                const w = rightPx - leftPx;\n                if (renderChevrons) {\n                    ctx.beginPath();\n                    ctx.moveTo(leftPx - 5, topPx + heightPx / 2);\n                    ctx.lineTo(leftPx, topPx + heightPx);\n                    ctx.lineTo(rightPx, topPx + heightPx);\n                    ctx.lineTo(rightPx, topPx);\n                    ctx.lineTo(leftPx, topPx);\n                    ctx.closePath();\n                    ctx.fill();\n                }\n                else {\n                    ctx.fillRect(leftPx, topPx, w, heightPx);\n                }\n            }\n        }\n    }\n    else {\n        const [leftPx, rightPx] = bpSpanPx(s, e, region, bpPerPx);\n        if (bpPerPx < 10 && heightPx > 5) {\n            if (strand === -1) {\n                ctx.beginPath();\n                ctx.moveTo(leftPx - 5, topPx + heightPx / 2);\n                ctx.lineTo(leftPx, topPx + heightPx);\n                ctx.lineTo(rightPx, topPx + heightPx);\n                ctx.lineTo(rightPx, topPx);\n                ctx.lineTo(leftPx, topPx);\n                ctx.closePath();\n                ctx.fill();\n            }\n            else {\n                ctx.beginPath();\n                ctx.moveTo(leftPx, topPx);\n                ctx.lineTo(leftPx, topPx + heightPx);\n                ctx.lineTo(rightPx, topPx + heightPx);\n                ctx.lineTo(rightPx + 5, topPx + heightPx / 2);\n                ctx.lineTo(rightPx, topPx);\n                ctx.closePath();\n                ctx.fill();\n            }\n        }\n        else {\n            ctx.fillRect(leftPx, topPx, rightPx - leftPx, heightPx);\n        }\n    }\n}\n","import { measureText } from '@jbrowse/core/util';\nexport function fillRect(ctx, l, t, w, h, cw, color) {\n    if (l + w < 0 || l > cw) {\n        return;\n    }\n    if (color) {\n        ctx.fillStyle = color;\n    }\n    ctx.fillRect(l, t, w, h);\n}\nexport function getColorBaseMap(theme) {\n    const { skip, deletion, insertion, hardclip, softclip, bases } = theme.palette;\n    return {\n        A: bases.A.main,\n        C: bases.C.main,\n        G: bases.G.main,\n        T: bases.T.main,\n        deletion,\n        insertion,\n        hardclip,\n        softclip,\n        skip,\n    };\n}\nexport function getContrastBaseMap(theme) {\n    return Object.fromEntries(Object.entries(getColorBaseMap(theme)).map(([key, value]) => [\n        key,\n        theme.palette.getContrastText(value),\n    ]));\n}\nexport function shouldDrawSNPsMuted(type) {\n    return ['methylation', 'modifications'].includes(type || '');\n}\nexport function shouldDrawIndels() {\n    return true;\n}\nexport function getCharWidthHeight() {\n    const charWidth = measureText('A');\n    const charHeight = measureText('M') - 2;\n    return { charWidth, charHeight };\n}\n","import { bpSpanPx } from '@jbrowse/core/util';\nimport { colord } from '@jbrowse/core/util/colord';\nimport { getMethBins } from '../../ModificationParser/getMethBins';\nimport { fillRect } from '../util';\nexport function renderMethylation({ ctx, feat, region, bpPerPx, renderArgs, canvasWidth, cigarOps, }) {\n    const { regionSequence } = renderArgs;\n    const { feature, topPx, heightPx } = feat;\n    if (!regionSequence) {\n        throw new Error('region sequence required for methylation');\n    }\n    const seq = feature.get('seq');\n    if (!seq) {\n        return;\n    }\n    const fstart = feature.get('start');\n    const fend = feature.get('end');\n    const { methBins, methProbs, hydroxyMethBins, hydroxyMethProbs } = getMethBins(feature, cigarOps);\n    function getCol(k) {\n        if (methBins[k]) {\n            const p = methProbs[k] || 0;\n            return (p > 0.5\n                ? colord('red').alpha((p - 0.5) * 2)\n                : colord('blue').alpha(1 - p * 2)).toHslString();\n        }\n        if (hydroxyMethBins[k]) {\n            const p = hydroxyMethProbs[k] || 0;\n            return (p > 0.5\n                ? colord('pink').alpha((p - 0.5) * 2)\n                : colord('purple').alpha(1 - p * 2)).toHslString();\n        }\n        return undefined;\n    }\n    const r = regionSequence.toLowerCase();\n    for (let i = 0; i < fend - fstart; i++) {\n        const j = i + fstart;\n        const l1 = r[j - region.start + 1];\n        const l2 = r[j - region.start + 2];\n        if (l1 === 'c' && l2 === 'g') {\n            if (bpPerPx > 2) {\n                const [leftPx, rightPx] = bpSpanPx(j, j + 2, region, bpPerPx);\n                const w = rightPx - leftPx + 0.5;\n                const c = getCol(i) || getCol(i + 1) || 'blue';\n                fillRect(ctx, leftPx, topPx, w, heightPx, canvasWidth, c);\n            }\n            else {\n                const [leftPx, rightPx] = bpSpanPx(j, j + 1, region, bpPerPx);\n                const w = rightPx - leftPx + 0.5;\n                const c = getCol(i) || 'blue';\n                fillRect(ctx, leftPx, topPx, w, heightPx, canvasWidth, c);\n                const [leftPx2, rightPx2] = bpSpanPx(j + 1, j + 2, region, bpPerPx);\n                const w2 = rightPx2 - leftPx2 + 0.5;\n                const c2 = getCol(i + 1) || 'blue';\n                fillRect(ctx, leftPx2, topPx, w2, heightPx, canvasWidth, c2);\n            }\n        }\n    }\n}\n","import { bpSpanPx, max, sum } from '@jbrowse/core/util';\nimport { getNextRefPos } from '../../MismatchParser';\nimport { getModPositions } from '../../ModificationParser/getModPositions';\nimport { getModProbabilities } from '../../ModificationParser/getModProbabilities';\nimport { getMaxProbModAtEachPosition } from '../../shared/getMaximumModificationAtEachPosition';\nimport { getModificationName } from '../../shared/modificationData';\nimport { alphaColor } from '../../shared/util';\nimport { getTagAlt } from '../../util';\nimport { fillRect } from '../util';\nexport function renderModifications({ ctx, feat, region, bpPerPx, renderArgs, canvasWidth, cigarOps, }) {\n    var _a, _b, _c, _d, _e;\n    const items = [];\n    const coords = [];\n    const { feature, topPx, heightPx } = feat;\n    const { colorBy, visibleModifications = {} } = renderArgs;\n    const seq = feature.get('seq');\n    if (!seq) {\n        return { coords, items };\n    }\n    const start = feature.get('start');\n    const isolatedModification = (_a = colorBy === null || colorBy === void 0 ? void 0 : colorBy.modifications) === null || _a === void 0 ? void 0 : _a.isolatedModification;\n    const twoColor = (_b = colorBy === null || colorBy === void 0 ? void 0 : colorBy.modifications) === null || _b === void 0 ? void 0 : _b.twoColor;\n    const modificationThreshold = (_d = (_c = colorBy === null || colorBy === void 0 ? void 0 : colorBy.modifications) === null || _c === void 0 ? void 0 : _c.threshold) !== null && _d !== void 0 ? _d : 10;\n    const thresholdFraction = modificationThreshold / 100;\n    const fstrand = feature.get('strand');\n    const mm = getTagAlt(feature, 'MM', 'Mm') || '';\n    const modifications = getModPositions(mm, seq, fstrand);\n    const probabilities = getModProbabilities(feature);\n    const modsByPosition = new Map();\n    let probIndex = 0;\n    for (const { type, base, strand, positions } of modifications) {\n        for (const { ref, idx } of getNextRefPos(cigarOps, positions)) {\n            const prob = (probabilities === null || probabilities === void 0 ? void 0 : probabilities[probIndex + (fstrand === -1 ? positions.length - 1 - idx : idx)]) || 0;\n            if (!modsByPosition.has(ref)) {\n                modsByPosition.set(ref, []);\n            }\n            modsByPosition.get(ref).push({ type, base, strand, prob });\n        }\n        probIndex += positions.length;\n    }\n    (_e = getMaxProbModAtEachPosition(feature, cigarOps)) === null || _e === void 0 ? void 0 : _e.forEach(({ allProbs, prob, type }, pos) => {\n        const r = start + pos;\n        const [leftPx, rightPx] = bpSpanPx(r, r + 1, region, bpPerPx);\n        const mod = visibleModifications[type];\n        if (!mod) {\n            console.warn(`${type} not known yet`);\n            return;\n        }\n        if (isolatedModification && mod.type !== isolatedModification) {\n            return;\n        }\n        if (prob < thresholdFraction) {\n            return;\n        }\n        const col = mod.color || 'black';\n        const s = 1 - sum(allProbs);\n        if (twoColor && s > max(allProbs)) {\n            const c = alphaColor('blue', s);\n            const w = rightPx - leftPx + 0.5;\n            fillRect(ctx, leftPx, topPx, w, heightPx, canvasWidth, c);\n        }\n        else {\n            const c = alphaColor(col, prob);\n            const w = rightPx - leftPx + 0.5;\n            fillRect(ctx, leftPx, topPx, w, heightPx, canvasWidth, c);\n        }\n        const modsAtPos = modsByPosition.get(pos) || [];\n        const strandInfo = modsAtPos\n            .map(m => `${m.base}${m.strand}${m.type} ${getModificationName(m.type)} (${(m.prob * 100).toFixed(1)}%)`)\n            .join('<br/>');\n        items.push({\n            type: 'modification',\n            seq: strandInfo || mod.base,\n            modType: type,\n            probability: prob,\n        });\n        coords.push(leftPx, topPx, rightPx, topPx + heightPx);\n        pos++;\n    });\n    return { coords, items };\n}\n","import { bpSpanPx } from '@jbrowse/core/util';\nimport { fillRect } from '../util';\nexport function renderPerBaseLettering({ ctx, feat, region, bpPerPx, colorMap, colorContrastMap, charWidth, charHeight, canvasWidth, cigarOps, }) {\n    const heightLim = charHeight - 2;\n    const { feature, topPx, heightPx } = feat;\n    const seq = feature.get('seq');\n    const w = 1 / bpPerPx;\n    const start = feature.get('start');\n    let soffset = 0;\n    let roffset = 0;\n    if (!seq) {\n        return;\n    }\n    for (let i = 0; i < cigarOps.length; i += 2) {\n        const len = +cigarOps[i];\n        const op = cigarOps[i + 1];\n        if (op === 'S' || op === 'I') {\n            soffset += len;\n        }\n        else if (op === 'D' || op === 'N') {\n            roffset += len;\n        }\n        else if (op === 'M' || op === 'X' || op === '=') {\n            for (let m = 0; m < len; m++) {\n                const letter = seq[soffset + m];\n                const r = start + roffset + m;\n                const [leftPx] = bpSpanPx(r, r + 1, region, bpPerPx);\n                const c = colorMap[letter];\n                fillRect(ctx, leftPx, topPx, w + 0.5, heightPx, canvasWidth, c);\n                if (w >= charWidth && heightPx >= heightLim) {\n                    ctx.fillStyle = colorContrastMap[letter];\n                    ctx.fillText(letter, leftPx + (w - charWidth) / 2 + 1, topPx + heightPx);\n                }\n            }\n            soffset += len;\n            roffset += len;\n        }\n    }\n}\n","import { bpSpanPx } from '@jbrowse/core/util';\nimport { fillRect } from '../util';\nexport function renderPerBaseQuality({ ctx, feat, region, bpPerPx, canvasWidth, cigarOps, }) {\n    const { feature, topPx, heightPx } = feat;\n    const qual = feature.get('qual') || '';\n    const scores = qual.split(' ').map(val => +val);\n    const w = 1 / bpPerPx;\n    const start = feature.get('start');\n    let soffset = 0;\n    let roffset = 0;\n    for (let i = 0; i < cigarOps.length; i += 2) {\n        const len = +cigarOps[i];\n        const op = cigarOps[i + 1];\n        if (op === 'S' || op === 'I') {\n            soffset += len;\n        }\n        else if (op === 'D' || op === 'N') {\n            roffset += len;\n        }\n        else if (op === 'M' || op === 'X' || op === '=') {\n            for (let m = 0; m < len; m++) {\n                const score = scores[soffset + m];\n                const start0 = start + roffset + m;\n                const leftPx = bpSpanPx(start0, start0 + 1, region, bpPerPx)[0];\n                const c = `hsl(${score === 255 ? 150 : score * 1.5},55%,50%)`;\n                fillRect(ctx, leftPx, topPx, w + 0.5, heightPx, canvasWidth, c);\n            }\n            soffset += len;\n            roffset += len;\n        }\n    }\n}\n","import { getAlignmentShapeColor } from './getAlignmentShapeColor';\nimport { renderAlignmentShape } from './renderAlignmentShape';\nimport { renderMethylation } from './renderMethylation';\nimport { renderModifications } from './renderModifications';\nimport { renderPerBaseLettering } from './renderPerBaseLettering';\nimport { renderPerBaseQuality } from './renderPerBaseQuality';\nimport { parseCigar } from '../../MismatchParser';\nexport function renderAlignment({ ctx, feat, renderArgs, colorMap, colorContrastMap, charWidth, charHeight, defaultColor, canvasWidth, }) {\n    const items = [];\n    const coords = [];\n    const { config, bpPerPx, regions, colorBy, colorTagMap = {} } = renderArgs;\n    const { tag = '', type: colorType = '' } = colorBy || {};\n    const { feature } = feat;\n    const region = regions[0];\n    ctx.fillStyle = getAlignmentShapeColor({\n        feature,\n        config,\n        tag,\n        defaultColor,\n        colorType,\n        colorTagMap,\n    });\n    renderAlignmentShape({ ctx, feat, renderArgs });\n    switch (colorType) {\n        case 'perBaseQuality': {\n            const cigarOps = parseCigar(feature.get('CIGAR'));\n            renderPerBaseQuality({\n                ctx,\n                feat,\n                region,\n                bpPerPx,\n                canvasWidth,\n                cigarOps,\n            });\n            break;\n        }\n        case 'perBaseLettering': {\n            const cigarOps = parseCigar(feature.get('CIGAR'));\n            renderPerBaseLettering({\n                ctx,\n                feat,\n                region,\n                bpPerPx,\n                colorMap,\n                colorContrastMap,\n                charWidth,\n                charHeight,\n                canvasWidth,\n                cigarOps,\n            });\n            break;\n        }\n        case 'modifications': {\n            const cigarOps = parseCigar(feature.get('CIGAR'));\n            const ret = renderModifications({\n                ctx,\n                feat,\n                region,\n                bpPerPx,\n                renderArgs,\n                canvasWidth,\n                cigarOps,\n            });\n            for (let i = 0, l = ret.coords.length; i < l; i++) {\n                coords.push(ret.coords[i]);\n            }\n            for (let i = 0, l = ret.items.length; i < l; i++) {\n                items.push(ret.items[i]);\n            }\n            break;\n        }\n        case 'methylation': {\n            const cigarOps = parseCigar(feature.get('CIGAR'));\n            renderMethylation({\n                ctx,\n                feat,\n                region,\n                bpPerPx,\n                renderArgs,\n                canvasWidth,\n                cigarOps,\n            });\n            break;\n        }\n    }\n    return { coords, items };\n}\n","import { bpSpanPx, measureText } from '@jbrowse/core/util';\nimport { colord } from '@jbrowse/core/util/colord';\nimport { fillRect } from '../util';\nexport function renderMismatches({ ctx, feat, renderArgs, minSubfeatureWidth, largeInsertionIndicatorScale, mismatchAlpha, charWidth, charHeight, colorMap, colorContrastMap, hideSmallIndels, canvasWidth, drawSNPsMuted, drawIndels = true, }) {\n    var _a;\n    const items = [];\n    const coords = [];\n    const { bpPerPx, regions } = renderArgs;\n    const { heightPx, topPx, feature } = feat;\n    const region = regions[0];\n    const start = feature.get('start');\n    const pxPerBp = Math.min(1 / bpPerPx, 2);\n    const mismatches = (_a = feature.get('mismatches')) !== null && _a !== void 0 ? _a : [];\n    const heightLim = charHeight - 2;\n    const extraHorizontallyFlippedOffset = region.reversed ? 1 / bpPerPx + 1 : -1;\n    for (const mismatch of mismatches) {\n        const mstart = start + mismatch.start;\n        const mlen = mismatch.length;\n        const mbase = mismatch.base;\n        const [leftPx, rightPx] = bpSpanPx(mstart, mstart + mlen, region, bpPerPx);\n        const widthPx = Math.max(minSubfeatureWidth, rightPx - leftPx);\n        if (mismatch.type === 'mismatch') {\n            items.push({\n                type: 'mismatch',\n                seq: mismatch.base,\n            });\n            coords.push(leftPx, topPx, rightPx, topPx + heightPx);\n            if (!drawSNPsMuted) {\n                const baseColor = colorMap[mismatch.base] || '#888';\n                const c = mismatchAlpha && mismatch.qual !== undefined\n                    ? colord(baseColor)\n                        .alpha(Math.min(1, mismatch.qual / 50))\n                        .toHslString()\n                    : baseColor;\n                fillRect(ctx, Math.round(leftPx), topPx, widthPx, heightPx, canvasWidth, c);\n            }\n            if (widthPx >= charWidth && heightPx >= heightLim) {\n                const contrastColor = drawSNPsMuted\n                    ? 'black'\n                    : colorContrastMap[mismatch.base] || 'black';\n                ctx.fillStyle =\n                    mismatchAlpha && mismatch.qual !== undefined\n                        ? colord(contrastColor)\n                            .alpha(Math.min(1, mismatch.qual / 50))\n                            .toHslString()\n                        : contrastColor;\n                ctx.fillText(mbase, leftPx + (widthPx - charWidth) / 2 + 1, topPx + heightPx);\n            }\n        }\n        else if (mismatch.type === 'deletion' && drawIndels) {\n            const len = mismatch.length;\n            if (!hideSmallIndels || len >= 10) {\n                fillRect(ctx, leftPx, topPx, Math.abs(leftPx - rightPx), heightPx, canvasWidth, colorMap.deletion);\n                items.push({\n                    type: 'deletion',\n                    seq: `${mismatch.length}`,\n                });\n                coords.push(leftPx, topPx, rightPx, topPx + heightPx);\n                const txt = `${mismatch.length}`;\n                const rwidth = measureText(txt, 10);\n                if (widthPx >= rwidth && heightPx >= heightLim) {\n                    ctx.fillStyle = colorContrastMap.deletion;\n                    ctx.fillText(txt, (leftPx + rightPx) / 2 - rwidth / 2, topPx + heightPx);\n                }\n            }\n        }\n        else if (mismatch.type === 'insertion' && drawIndels) {\n            const pos = leftPx + extraHorizontallyFlippedOffset;\n            const len = +mismatch.base || mismatch.length;\n            const insW = Math.max(0, Math.min(1.2, 1 / bpPerPx));\n            if (len < 10) {\n                if (!hideSmallIndels) {\n                    fillRect(ctx, pos, topPx, insW, heightPx, canvasWidth, colorMap.insertion);\n                    if (1 / bpPerPx >= charWidth && heightPx >= heightLim) {\n                        items.push({\n                            type: 'insertion',\n                            seq: mismatch.insertedBases || 'unknown',\n                        });\n                        coords.push(leftPx - 2, topPx, leftPx + insW + 2, topPx + heightPx);\n                        const l = Math.round(pos - insW);\n                        fillRect(ctx, l, topPx, insW * 3, 1, canvasWidth);\n                        fillRect(ctx, l, topPx + heightPx - 1, insW * 3, 1, canvasWidth);\n                        ctx.fillText(`(${mismatch.base})`, pos + 3, topPx + heightPx);\n                    }\n                }\n            }\n        }\n        else if (mismatch.type === 'hardclip' || mismatch.type === 'softclip') {\n            const pos = leftPx + extraHorizontallyFlippedOffset;\n            const c = colorMap[mismatch.type];\n            const clipW = Math.max(minSubfeatureWidth, pxPerBp);\n            fillRect(ctx, pos, topPx, clipW, heightPx, canvasWidth, c);\n            if (1 / bpPerPx >= charWidth && heightPx >= heightLim) {\n                const l = pos - clipW;\n                fillRect(ctx, l, topPx, clipW * 3, 1, canvasWidth);\n                fillRect(ctx, l, topPx + heightPx - 1, clipW * 3, 1, canvasWidth);\n                ctx.fillText(`(${mismatch.base})`, pos + 3, topPx + heightPx);\n            }\n        }\n        else if (mismatch.type === 'skip') {\n            if (leftPx + widthPx > 0) {\n                const adjustPx = widthPx - (bpPerPx > 10 ? 1.5 : 0);\n                const l = Math.max(0, leftPx);\n                const t = topPx + heightPx / 2 - 1;\n                const w = adjustPx + Math.min(leftPx, 0);\n                const h = 1;\n                fillRect(ctx, l, t, w, h, canvasWidth, colorMap.skip);\n            }\n        }\n    }\n    if (drawIndels) {\n        for (const mismatch of mismatches) {\n            const mstart = start + mismatch.start;\n            const mlen = mismatch.length;\n            const len = +mismatch.base || mismatch.length;\n            if (mismatch.type === 'insertion' && len >= 10) {\n                const [leftPx] = bpSpanPx(mstart, mstart + mlen, region, bpPerPx);\n                const txt = `${len}`;\n                items.push({\n                    type: 'insertion',\n                    seq: mismatch.insertedBases || 'unknown',\n                });\n                coords.push(leftPx - 3, topPx, leftPx + 4, topPx + heightPx);\n                if (bpPerPx > largeInsertionIndicatorScale) {\n                    fillRect(ctx, leftPx - 1, topPx, 2, heightPx, canvasWidth, colorMap.insertion);\n                }\n                else if (heightPx > charHeight) {\n                    const rwidth = measureText(txt);\n                    const padding = 5;\n                    fillRect(ctx, leftPx - rwidth / 2 - padding, topPx, rwidth + 2 * padding, heightPx, canvasWidth, 'purple');\n                    ctx.fillStyle = colorContrastMap.insertion;\n                    ctx.fillText(txt, leftPx - rwidth / 2, topPx + heightPx);\n                }\n                else {\n                    const padding = 2;\n                    fillRect(ctx, leftPx - padding, topPx, 2 * padding, heightPx, canvasWidth, colorMap.insertion);\n                }\n            }\n        }\n    }\n    return {\n        coords,\n        items,\n    };\n}\n","import { readConfObject } from '@jbrowse/core/configuration';\nimport { bpSpanPx } from '@jbrowse/core/util';\nimport { parseCigar } from '../../MismatchParser';\nimport { fillRect, getCharWidthHeight } from '../util';\nexport function renderSoftClipping({ ctx, feat, renderArgs, config, theme, colorMap, canvasWidth, }) {\n    const { feature, topPx, heightPx } = feat;\n    const { regions, bpPerPx } = renderArgs;\n    const region = regions[0];\n    const minFeatWidth = readConfObject(config, 'minSubfeatureWidth');\n    const mismatches = feature.get('mismatches');\n    const seq = feature.get('seq');\n    const { charWidth, charHeight } = getCharWidthHeight();\n    if (!(seq && mismatches)) {\n        return;\n    }\n    const heightLim = charHeight - 2;\n    let seqOffset = 0;\n    let refOffset = 0;\n    const CIGAR = feature.get('CIGAR');\n    const cigarOps = parseCigar(CIGAR);\n    for (let i = 0; i < cigarOps.length; i += 2) {\n        const op = cigarOps[i + 1];\n        const len = +cigarOps[i];\n        if (op === 'S') {\n            for (let k = 0; k < len; k++) {\n                const base = seq[seqOffset + k];\n                const s0 = feature.get('start') - (i === 0 ? len : 0) + refOffset + k;\n                const [leftPx, rightPx] = bpSpanPx(s0, s0 + 1, region, bpPerPx);\n                const widthPx = Math.max(minFeatWidth, rightPx - leftPx);\n                const baseColor = colorMap[base] || '#000000';\n                ctx.fillStyle = baseColor;\n                fillRect(ctx, leftPx, topPx, widthPx, heightPx, canvasWidth);\n                if (widthPx >= charWidth && heightPx >= heightLim) {\n                    ctx.fillStyle = theme.palette.getContrastText(baseColor);\n                    ctx.fillText(base, leftPx + (widthPx - charWidth) / 2 + 1, topPx + heightPx);\n                }\n            }\n            seqOffset += len;\n        }\n        if (op === 'N') {\n            refOffset += len;\n        }\n        if (op === 'M' || op === '=' || op === 'X') {\n            refOffset += len;\n            seqOffset += len;\n        }\n        if (op === 'H') {\n        }\n        if (op === 'D') {\n            refOffset += len;\n        }\n        if (op === 'I') {\n            seqOffset += len;\n        }\n    }\n}\n","import { readConfObject } from '@jbrowse/core/configuration';\nimport { createJBrowseTheme } from '@jbrowse/core/ui';\nimport { forEachWithStopTokenCheck } from '@jbrowse/core/util';\nimport Flatbush from '@jbrowse/core/util/flatbush';\nimport { renderAlignment } from './renderers/renderAlignment';\nimport { renderMismatches } from './renderers/renderMismatches';\nimport { renderSoftClipping } from './renderers/renderSoftClipping';\nimport { getCharWidthHeight, getColorBaseMap, getContrastBaseMap, shouldDrawIndels, shouldDrawSNPsMuted, } from './util';\nexport function makeImageData({ ctx, layoutRecords, canvasWidth, renderArgs, }) {\n    const { stopToken, config, showSoftClip, colorBy, theme: configTheme, } = renderArgs;\n    const mismatchAlpha = readConfObject(config, 'mismatchAlpha');\n    const minSubfeatureWidth = readConfObject(config, 'minSubfeatureWidth');\n    const largeInsertionIndicatorScale = readConfObject(config, 'largeInsertionIndicatorScale');\n    const hideSmallIndels = readConfObject(config, 'hideSmallIndels');\n    const defaultColor = readConfObject(config, 'color') === '#f0f';\n    const theme = createJBrowseTheme(configTheme);\n    const colorMap = getColorBaseMap(theme);\n    const colorContrastMap = getContrastBaseMap(theme);\n    ctx.font = 'bold 10px Courier New,monospace';\n    const { charWidth, charHeight } = getCharWidthHeight();\n    const drawSNPsMuted = shouldDrawSNPsMuted(colorBy === null || colorBy === void 0 ? void 0 : colorBy.type);\n    const drawIndels = shouldDrawIndels();\n    const coords = [];\n    const items = [];\n    forEachWithStopTokenCheck(layoutRecords, stopToken, feat => {\n        const alignmentRet = renderAlignment({\n            ctx,\n            feat,\n            renderArgs,\n            defaultColor,\n            colorMap,\n            colorContrastMap,\n            charWidth,\n            charHeight,\n            canvasWidth,\n        });\n        for (let i = 0, l = alignmentRet.coords.length; i < l; i++) {\n            coords.push(alignmentRet.coords[i]);\n        }\n        for (let i = 0, l = alignmentRet.items.length; i < l; i++) {\n            items.push(alignmentRet.items[i]);\n        }\n        const ret = renderMismatches({\n            ctx,\n            feat,\n            renderArgs,\n            hideSmallIndels,\n            mismatchAlpha,\n            drawSNPsMuted,\n            drawIndels,\n            largeInsertionIndicatorScale,\n            minSubfeatureWidth,\n            charWidth,\n            charHeight,\n            colorMap,\n            colorContrastMap,\n            canvasWidth,\n        });\n        for (let i = 0, l = ret.coords.length; i < l; i++) {\n            coords.push(ret.coords[i]);\n        }\n        for (let i = 0, l = ret.items.length; i < l; i++) {\n            items.push(ret.items[i]);\n        }\n        if (showSoftClip) {\n            renderSoftClipping({\n                ctx,\n                feat,\n                renderArgs,\n                colorMap,\n                config,\n                theme,\n                canvasWidth,\n            });\n        }\n    });\n    const flatbush = new Flatbush(Math.max(items.length, 1));\n    if (coords.length) {\n        for (let i = 0; i < coords.length; i += 4) {\n            flatbush.add(coords[i], coords[i + 1], coords[i + 2], coords[i + 3]);\n        }\n    }\n    else {\n        flatbush.add(0, 0);\n    }\n    flatbush.finish();\n    return {\n        flatbush: flatbush.data,\n        items,\n    };\n}\n"],"names":["colorByInsertSize","feature","colorByMappingQuality","getOrientation","config","orientationType","readConfObject","orientation","orientationTypes","colorByStrand","colorByOrientation","fillColor","getStranded","flags","strand","flipper","colorByStrandedRnaSeq","getAlignmentShapeColor","colorType","tag","defaultColor","colorTagMap","tags","val","renderAlignmentShape","ctx","feat","renderArgs","regions","bpPerPx","heightPx","topPx","region","s","e","CIGAR","flip","renderChevrons","cigarOps","parseCigar","drawLen","drawStart","i","opLen","op","leftPx","rightPx","bpSpanPx","w","fillRect","l","t","h","cw","color","getColorBaseMap","theme","skip","deletion","insertion","hardclip","softclip","bases","getContrastBaseMap","key","value","shouldDrawSNPsMuted","type","shouldDrawIndels","getCharWidthHeight","charWidth","measureText","charHeight","renderMethylation","canvasWidth","regionSequence","fstart","fend","methBins","methProbs","hydroxyMethBins","hydroxyMethProbs","getMethBins","getCol","k","p","colord","r","j","l1","l2","c","leftPx2","rightPx2","w2","c2","renderModifications","_a","_b","_c","_d","_e","items","coords","colorBy","visibleModifications","seq","start","isolatedModification","twoColor","thresholdFraction","fstrand","mm","getTagAlt","modifications","getModPositions","probabilities","getModProbabilities","modsByPosition","probIndex","base","positions","ref","idx","getNextRefPos","prob","getMaxProbModAtEachPosition","allProbs","pos","mod","col","sum","max","alphaColor","strandInfo","m","getModificationName","renderPerBaseLettering","colorMap","colorContrastMap","heightLim","soffset","roffset","len","letter","renderPerBaseQuality","scores","score","start0","renderAlignment","ret","renderMismatches","minSubfeatureWidth","largeInsertionIndicatorScale","mismatchAlpha","hideSmallIndels","drawSNPsMuted","drawIndels","pxPerBp","mismatches","extraHorizontallyFlippedOffset","mismatch","mstart","mlen","mbase","widthPx","baseColor","contrastColor","txt","rwidth","insW","clipW","adjustPx","padding","renderSoftClipping","minFeatWidth","seqOffset","refOffset","s0","makeImageData","layoutRecords","stopToken","showSoftClip","configTheme","createJBrowseTheme","forEachWithStopTokenCheck","alignmentRet","flatbush","Flatbush"],"mappings":"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","x_google_ignoreList":[0,1,2,3,4,5,6,7,8,9,10,11]}