import{r as g,j as e,u as C,c as H,m as v,b as u,bE as I,bF as R,bG as F,bH as O,I as M,J as P,K as T,L as G,bb as N}from"./rpcWorker-X0469dqW.js";import{a as A,C as B}from"./ColorPicker-BiE6j3uq.js";import{D as K}from"./DataGrid-CDeG2vOy.js";import{c as U,D as W}from"./index-lV36Xh8Y.js";import"./getThemeProps-RNW6Z-3w.js";import"./FormControlLabel-1s92K5sy.js";import"./MenuItem-CxTol2m1.js";import"./dividerClasses-BkmUKgu8.js";import"./Divider-DsWTSitt.js";import"./Badge-BKK_x0o6.js";import"./TableCell-BPTDO_V-.js";import"./Checkbox-CZRpP34h.js";const _=v()({cell:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}});function $({rows:t,onChange:s,setSelected:c}){const{classes:n}=_(),{id:r,name:l,label:o,color:d,baseUri:h,HP:m,...x}=t[0],[i,f]=g.useState({idx:0,field:null});return e.jsx("div",{style:{height:400,width:"100%"},children:e.jsx(K,{checkboxSelection:!0,disableRowSelectionOnClick:!0,onRowSelectionModelChange:a=>{c([...a.ids])},rows:t,rowHeight:25,columnHeaderHeight:33,columns:[{field:"color",headerName:"Color",renderCell:a=>{const{value:p,id:j}=a;return e.jsx(A,{color:p||"blue",onChange:b=>{const S=t.find(w=>w.name===j);S&&(S.color=b),s([...t])}})}},{field:"label",headerName:"Name",width:C.measureGridWidth(t.map(a=>a.label))},...Object.keys(x).map(a=>({field:a,renderCell:({value:p})=>e.jsx("div",{className:n.cell,children:e.jsx(H.SanitizedHTML,{html:C.getStr(p)})}),width:C.measureGridWidth(t.map(p=>`${p[a]}`))}))],sortModel:[],onSortModelChange:a=>{const p=a[0],j=(i.idx+1)%2,b=p.field||i.field;f({idx:j,field:b}),s(b?[...t].sort((S,w)=>{const k=C.getStr(S[b]),y=C.getStr(w[b]);return j===1?k.localeCompare(y):y.localeCompare(k)}):t)}})})}function E(t,s,c=1){const n=s.map(l=>t.findIndex(o=>o.name===l)).sort((l,o)=>l-o);let r=0;for(const l of n){const o=Math.max(r,l-c);o>=r&&t.splice(o,0,t.splice(l,1)[0]),r=r+1}return t}function D(t,s,c=1){const n=s.map(l=>t.findIndex(o=>o.name===l)).sort((l,o)=>o-l);let r=t.length-1;for(const l of n){const o=Math.min(r,l+c);o<=r&&t.splice(o,0,t.splice(l,1)[0]),r=r-1}return t}function z({selected:t,onChange:s,rows:c,showTips:n}){const[r,l]=g.useState(null),[o,d]=g.useState("blue");return e.jsxs(e.Fragment,{children:[e.jsx(u,{disabled:!t.length,onClick:h=>{l(h.currentTarget)},children:"Change color of selected items"}),e.jsxs(u,{onClick:()=>{s(E([...c],t))},disabled:!t.length,children:[e.jsx(I,{}),n?"Move selected items up":null]}),e.jsxs(u,{onClick:()=>{s(D([...c],t))},disabled:!t.length,children:[e.jsx(R,{}),n?"Move selected items down":null]}),e.jsxs(u,{onClick:()=>{s(E([...c],t,c.length))},disabled:!t.length,children:[e.jsx(F,{}),n?"Move selected items to top":null]}),e.jsxs(u,{onClick:()=>{s(D([...c],t,c.length))},disabled:!t.length,children:[e.jsx(O,{}),n?"Move selected items to bottom":null]}),e.jsx(B.ColorPopover,{anchorEl:r,color:o,onChange:h=>{d(h);for(const m of t){const x=c.find(i=>i.name===m);x&&(x.color=h)}s([...c])},onClose:()=>{l(null)}})]})}function L({rows:t,onChange:s,showTips:c}){const[n,r]=g.useState([]);return e.jsxs("div",{children:[e.jsx(z,{selected:n,rows:t,showTips:c,onChange:s}),t.length?e.jsx($,{rows:t,onChange:s,setSelected:r}):e.jsx("div",{children:"No rows"})]})}const V=v()({textAreaFont:{fontFamily:"Courier New"}});function Y({onClose:t,currLayout:s}){const{classes:c}=V(),[n,r]=g.useState(""),[l,o]=g.useState();return e.jsxs(e.Fragment,{children:[e.jsxs(M,{children:[e.jsx(P,{children:'Paste CSV or TSV. If a header column is present. First line is a header. If a column called "name" is present, it uses that to connect to IDs in the table, otherwise it uses the first column no.'}),l?e.jsx(H.ErrorMessage,{error:l}):null,e.jsx(T,{variant:"outlined",multiline:!0,minRows:5,placeholder:`name,population
HG00098,GBR
HG00101,GBR
HG00459,CHS
...`,maxRows:10,fullWidth:!0,value:n,onChange:d=>{r(d.target.value)},slotProps:{input:{classes:{input:c.textAreaFont}}}})]}),e.jsxs(G,{children:[e.jsx(u,{variant:"contained",color:"secondary",onClick:()=>{const d=n.split(`
`).map(m=>m.trim()).filter(m=>!!m),h=d[0].split(/[,\t]/gm);if(h.includes("name")){o("");const m=Object.fromEntries(s.map(i=>[i.name,i])),x=Object.fromEntries(d.slice(1).map(i=>{const f=i.split(/[,\t]/gm),a=Object.fromEntries(f.map((p,j)=>[h[j],p]));return[a.name,{...a,...m[a.name]}]}));t(s.map(i=>({...i,...x[i.name]})))}else o(new Error('No "name" column found on line 1'))},children:"Update rows"}),e.jsx(u,{variant:"contained",color:"primary",onClick:()=>{const d=n.split(`
`).map(m=>m.trim()).filter(m=>!!m),h=d[0].split(/[,\t]/gm);if(h.includes("name")){o("");const m=Object.fromEntries(s.map(i=>[i.name,i])),x=Object.fromEntries(d.slice(1).map(i=>{const f=i.split(/[,\t]/gm),a=Object.fromEntries(f.map((p,j)=>[h[j],p]));return[a.name,{...a,...m[a.name]}]}));t(s.map(i=>({...x[i.name]})))}else o(new Error('No "name" column found on line 1'))},children:"Replace rows"}),e.jsx(u,{variant:"contained",color:"inherit",onClick:()=>{t()},children:"Cancel"})]})]})}function J(){return e.jsxs(e.Fragment,{children:["Helpful tips",e.jsxs("ul",{children:[e.jsx("li",{children:"You can select rows in the table with the checkboxes"}),e.jsx("li",{children:"Multi-select is enabled with shift-click and control-click"}),e.jsx("li",{children:'The "Move selected items up/down" can re-arrange subtracks'}),e.jsx("li",{children:"Sorting the data grid itself can also re-arrange subtracks"}),e.jsx("li",{children:"Changes are applied when you hit Submit"}),e.jsx("li",{children:"You can click and drag the dialog box to move it on the screen"}),e.jsx("li",{children:"Columns in the table can be hidden using a vertical '...' menu on the right side of each column"})]})]})}function q({setCurrLayout:t,currLayout:s}){if(!s.length||!s[0])return null;const c=Object.keys(s[0]).filter(n=>n!=="name"&&n!=="color"&&n!=="label"&&n!=="id"&&n!=="HP");return e.jsxs("div",{children:["Create color palette based on...",c.map(n=>e.jsx(u,{variant:"contained",color:"inherit",onClick:()=>{const r=new Map;for(const o of s){const d=r.get(o[n]);d?r.set(o[n],d+1):r.set(o[n],1)}const l=Object.fromEntries([...r.entries()].sort((o,d)=>o[1]-d[1]).map((o,d)=>[o[0],N.set1[d]||U.randomColor(o[0])]));t(s.map(o=>({...o,color:l[o[n]]})))},children:n},n)),e.jsx(u,{onClick:()=>{t(s.map(n=>({...n,color:void 0})))},children:"Clear colors"})]})}const Q=v()({content:{minWidth:800},fr:{float:"right",display:"flex",gap:8}});function X({model:t,handleClose:s,title:c="Color/arrangement editor",enableBulkEdit:n=!1,enableRowPalettizer:r=!1,showTipsStorageKey:l="setColorDialog-showTips",SourcesGridComponent:o}){const{classes:d}=Q(),{sources:h}=t,[m,x]=g.useState(!1),[i,f]=g.useState(structuredClone(h||[])),[a,p]=C.useLocalStorage(l,!1);return e.jsx(W,{open:!0,onClose:s,maxWidth:"xl",title:c,children:m&&n?e.jsx(Y,{currLayout:i,onClose:j=>{j&&f(j),x(!1)}}):e.jsxs(e.Fragment,{children:[e.jsxs(M,{className:d.content,children:[e.jsxs("div",{className:d.fr,children:[e.jsx(u,{variant:"contained",onClick:()=>{p(!a)},children:a?"Hide tips":"Show tips"}),n?e.jsx(u,{color:"secondary",variant:"contained",onClick:()=>{x(!m)},children:"Show Bulk row editor"}):null]}),a?e.jsx(J,{}):null,r?e.jsxs(e.Fragment,{children:[e.jsx("br",{}),e.jsx(q,{currLayout:i,setCurrLayout:f})]}):null,e.jsx(o,{rows:i,onChange:f,showTips:a})]}),e.jsxs(G,{children:[e.jsx(u,{variant:"contained",type:"submit",color:"inherit",onClick:()=>{t.clearLayout(),f(t.sources||[])},children:"Clear custom settings"}),e.jsx(u,{variant:"contained",color:"secondary",onClick:()=>{s(),f([...t.sources||[]])},children:"Cancel"}),e.jsx(u,{variant:"contained",color:"primary",type:"submit",onClick:()=>{t.setLayout(i),s()},children:"Submit"})]})]})})}function me({model:t,handleClose:s}){return e.jsx(X,{model:t,handleClose:s,title:"Multi-sample variant display - Color/arrangement editor",enableBulkEdit:!0,enableRowPalettizer:!0,showTipsStorageKey:"multivariant-showTips",SourcesGridComponent:L})}export{me as default};
//# sourceMappingURL=SetColorDialog-CkE1sHt5.js.map
