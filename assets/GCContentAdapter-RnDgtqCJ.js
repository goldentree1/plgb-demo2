import{B as b}from"./index-D8SKdkWL.js";import{a2 as j,a3 as z,u as A,R as B}from"./index-DUxFddIG.js";import{r as q}from"./rxjs-CJV8ZOVO.js";class D extends b.BaseFeatureDataAdapter{constructor(){super(...arguments),this.gcMode="content"}async configure(){var n;const d=await((n=this.getSubAdapter)===null||n===void 0?void 0:n.call(this,this.getConf("sequenceAdapter")));if(!d)throw new Error("Error getting subadapter");return d.dataAdapter}async getRefNames(n){return(await this.configure()).getRefNames(n)}getFeatures(n,d){const{statusCallback:E=()=>{},stopToken:N}=d||{};return q.ObservableCreate(async g=>{var h;const v=await this.configure(),r=this.getConf("windowSize"),u=this.getConf("windowDelta"),e=r===1?1:Math.ceil(r/2),k=r===1,w=Math.max(0,Math.floor((n.start-e)/r)*r),m=Math.ceil((n.end+e)/r)*r;if(m<0||w>m){g.complete();return}const i=((h=(await j(v.getFeatures({...n,start:w,end:m},d).pipe(z())))[0])===null||h===void 0?void 0:h.get("seq"))||"";await A.updateStatus("Calculating GC",E,()=>{let c=0,l=0,p=0,C=performance.now();const x=e;for(let t=x-e;t<x+e;t++){const o=i[t];o==="c"||o==="C"?c++:(o==="g"||o==="G")&&l++,o!=="N"&&p++}for(let t=e;t<i.length-e;t+=u){if(performance.now()-C>400&&(B.checkStopToken(N),C=performance.now()),k){const f=i[t];c=f==="c"||f==="C"?1:0,l=f==="g"||f==="G"?1:0,p=f!=="N"?1:0}else if(t>e){const f=t-u-e,S=t-u+e,M=t-e,F=t+e;for(let a=f;a<Math.min(S,M);a++)if(a>=0&&a<i.length){const s=i[a];s==="c"||s==="C"?c--:(s==="g"||s==="G")&&l--,s!=="N"&&p--}for(let a=Math.max(S,M);a<F;a++)if(a>=0&&a<i.length){const s=i[a];s==="c"||s==="C"?c++:(s==="g"||s==="G")&&l++,s!=="N"&&p++}}const o=w,G=this.gcMode==="content"?(l+c)/(p||1):this.gcMode==="skew"?(l-c)/(l+c||1):0;g.next(new A.SimpleFeature({uniqueId:`${this.id}_${o+t}`,refName:n.refName,start:o+t,end:o+t+u,score:G}))}}),g.complete()})}}D.capabilities=["hasLocalStats"];export{D as default};
//# sourceMappingURL=GCContentAdapter-RnDgtqCJ.js.map
