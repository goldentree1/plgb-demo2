{"version":3,"file":"afterAttach-BNbKhI9p.js","sources":["../../node_modules/@jbrowse/plugin-alignments/esm/shared/fetchChains.js","../../node_modules/@jbrowse/plugin-alignments/esm/shared/afterAttach.js"],"sourcesContent":["import { getContainingView, getSession } from '@jbrowse/core/util';\nimport { getRpcSessionId } from '@jbrowse/core/util/tracks';\nexport async function fetchChains(self) {\n    const sessionId = getRpcSessionId(self);\n    const { rpcManager } = getSession(self);\n    const view = getContainingView(self);\n    if (!view.initialized || self.error || !self.statsReadyAndRegionNotTooLarge) {\n        return;\n    }\n    self.setLoading(true);\n    const ret = (await rpcManager.call(sessionId, 'PileupGetReducedFeatures', {\n        sessionId,\n        regions: view.staticBlocks.contentBlocks,\n        filterBy: self.filterBy,\n        adapterConfig: self.adapterConfig,\n    }));\n    self.setChainData(ret);\n    self.setLoading(false);\n}\n","import { getContainingView } from '@jbrowse/core/util';\nimport { createAutorun } from '../util';\nimport { fetchChains } from './fetchChains';\nexport function doAfterAttach(self, cb) {\n    createAutorun(self, async () => {\n        await fetchChains(self);\n    }, { delay: 1000 });\n    function draw(view) {\n        const canvas = self.ref;\n        if (!canvas) {\n            return;\n        }\n        const ctx = canvas.getContext('2d');\n        if (!ctx) {\n            return;\n        }\n        if (!self.chainData) {\n            return;\n        }\n        const height = 'layoutHeight' in self ? self.layoutHeight || 1 : self.height;\n        ctx.resetTransform();\n        ctx.clearRect(0, 0, canvas.width, canvas.height);\n        ctx.scale(2, 2);\n        cb(self, ctx, canvas.width, height);\n        self.setLastDrawnOffsetPx(view.offsetPx);\n        self.setLastDrawnBpPerPx(view.bpPerPx);\n    }\n    createAutorun(self, async () => {\n        const view = getContainingView(self);\n        if (view.bpPerPx !== self.lastDrawnBpPerPx) {\n            draw(view);\n        }\n    });\n    createAutorun(self, async () => {\n        const view = getContainingView(self);\n        draw(view);\n    }, { delay: 1000 });\n}\n"],"names":["fetchChains","self","sessionId","getRpcSessionId","rpcManager","getSession","view","getContainingView","ret","doAfterAttach","cb","createAutorun","draw","canvas","ctx","height"],"mappings":"sDAEO,eAAeA,EAAYC,EAAM,CACpC,MAAMC,EAAYC,EAAAA,gBAAgBF,CAAI,EAChC,CAAE,WAAAG,CAAU,EAAKC,EAAAA,WAAWJ,CAAI,EAChCK,EAAOC,EAAAA,kBAAkBN,CAAI,EACnC,GAAI,CAACK,EAAK,aAAeL,EAAK,OAAS,CAACA,EAAK,+BACzC,OAEJA,EAAK,WAAW,EAAI,EACpB,MAAMO,EAAO,MAAMJ,EAAW,KAAKF,EAAW,2BAA4B,CACtE,UAAAA,EACA,QAASI,EAAK,aAAa,cAC3B,SAAUL,EAAK,SACf,cAAeA,EAAK,aAC5B,CAAK,EACDA,EAAK,aAAaO,CAAG,EACrBP,EAAK,WAAW,EAAK,CACzB,CCfO,SAASQ,EAAcR,EAAMS,EAAI,CACpCC,EAAcV,EAAM,SAAY,CAC5B,MAAMD,EAAYC,CAAI,CAC1B,EAAG,CAAE,MAAO,IAAM,EAClB,SAASW,EAAKN,EAAM,CAChB,MAAMO,EAASZ,EAAK,IACpB,GAAI,CAACY,EACD,OAEJ,MAAMC,EAAMD,EAAO,WAAW,IAAI,EAIlC,GAHI,CAACC,GAGD,CAACb,EAAK,UACN,OAEJ,MAAMc,EAAS,iBAAkBd,EAAOA,EAAK,cAAgB,EAAIA,EAAK,OACtEa,EAAI,eAAc,EAClBA,EAAI,UAAU,EAAG,EAAGD,EAAO,MAAOA,EAAO,MAAM,EAC/CC,EAAI,MAAM,EAAG,CAAC,EACdJ,EAAGT,EAAMa,EAAKD,EAAO,MAAOE,CAAM,EAClCd,EAAK,qBAAqBK,EAAK,QAAQ,EACvCL,EAAK,oBAAoBK,EAAK,OAAO,CACzC,CACAK,EAAcV,EAAM,SAAY,CAC5B,MAAMK,EAAOC,EAAAA,kBAAkBN,CAAI,EAC/BK,EAAK,UAAYL,EAAK,kBACtBW,EAAKN,CAAI,CAEjB,CAAC,EACDK,EAAcV,EAAM,SAAY,CAC5B,MAAMK,EAAOC,EAAAA,kBAAkBN,CAAI,EACnCW,EAAKN,CAAI,CACb,EAAG,CAAE,MAAO,IAAM,CACtB","x_google_ignoreList":[0,1]}