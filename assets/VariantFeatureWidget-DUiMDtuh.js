import{r as f,l as z,n as H,q as I,j as o,v as U,aN as L,w as V,x as Q,y as J,bW as K,aY as Y,J as N,u as A,K as X,bX as Z,bY as ee,c as te,o as E,S as oe,aD as ne}from"./rpcWorker-X0469dqW.js";import{B as D,F as se}from"./FeatureDetails-CnuNWLxG.js";import{D as _}from"./DataGridFlexContainer-DyRg75p6.js";import{F as q}from"./FormControlLabel-1s92K5sy.js";import{C as P}from"./Checkbox-CZRpP34h.js";import{T as re,a as ie,t as G,D as M,b as k}from"./DataGrid-CDeG2vOy.js";import"./getThemeProps-RNW6Z-3w.js";import"./MenuItem-CxTol2m1.js";import"./dividerClasses-BkmUKgu8.js";import"./Divider-DsWTSitt.js";import"./Badge-BKK_x0o6.js";import"./TableCell-BPTDO_V-.js";function le(e){return f.Children.toArray(e).filter(s=>f.isValidElement(s))}function ae(e){return z("MuiToggleButtonGroup",e)}const d=H("MuiToggleButtonGroup",["root","selected","horizontal","vertical","disabled","grouped","groupedHorizontal","groupedVertical","fullWidth","firstButton","lastButton","middleButton"]),de=e=>{const{classes:s,orientation:t,fullWidth:n,disabled:a}=e,i={root:["root",t,n&&"fullWidth"],grouped:["grouped",`grouped${L(t)}`,a&&"disabled"],firstButton:["firstButton"],lastButton:["lastButton"],middleButton:["middleButton"]};return V(i,ae,s)},ue=Q("div",{name:"MuiToggleButtonGroup",slot:"Root",overridesResolver:(e,s)=>{const{ownerState:t}=e;return[{[`& .${d.grouped}`]:s.grouped},{[`& .${d.grouped}`]:s[`grouped${L(t.orientation)}`]},{[`& .${d.firstButton}`]:s.firstButton},{[`& .${d.lastButton}`]:s.lastButton},{[`& .${d.middleButton}`]:s.middleButton},s.root,t.orientation==="vertical"&&s.vertical,t.fullWidth&&s.fullWidth]}})(J(({theme:e})=>({display:"inline-flex",borderRadius:(e.vars||e).shape.borderRadius,variants:[{props:{orientation:"vertical"},style:{flexDirection:"column",[`& .${d.grouped}`]:{[`&.${d.selected} + .${d.grouped}.${d.selected}`]:{borderTop:0,marginTop:0}},[`& .${d.firstButton},& .${d.middleButton}`]:{borderBottomLeftRadius:0,borderBottomRightRadius:0},[`& .${d.lastButton},& .${d.middleButton}`]:{marginTop:-1,borderTop:"1px solid transparent",borderTopLeftRadius:0,borderTopRightRadius:0},[`& .${d.lastButton}.${G.disabled},& .${d.middleButton}.${G.disabled}`]:{borderTop:"1px solid transparent"}}},{props:{fullWidth:!0},style:{width:"100%"}},{props:{orientation:"horizontal"},style:{[`& .${d.grouped}`]:{[`&.${d.selected} + .${d.grouped}.${d.selected}`]:{borderLeft:0,marginLeft:0}},[`& .${d.firstButton},& .${d.middleButton}`]:{borderTopRightRadius:0,borderBottomRightRadius:0},[`& .${d.lastButton},& .${d.middleButton}`]:{marginLeft:-1,borderLeft:"1px solid transparent",borderTopLeftRadius:0,borderBottomLeftRadius:0},[`& .${d.lastButton}.${G.disabled},& .${d.middleButton}.${G.disabled}`]:{borderLeft:"1px solid transparent"}}}]}))),ce=f.forwardRef(function(s,t){const n=I({props:s,name:"MuiToggleButtonGroup"}),{children:a,className:i,color:u="standard",disabled:l=!1,exclusive:r=!1,fullWidth:p=!1,onChange:c,orientation:m="horizontal",size:x="medium",value:h,...w}=n,T={...n,disabled:l,fullWidth:p,orientation:m,size:x},j=de(T),B=f.useCallback((v,b)=>{if(!c)return;const $=h&&h.indexOf(b);let F;h&&$>=0?(F=h.slice(),F.splice($,1)):F=h?h.concat(b):[b],c(v,F)},[c,h]),S=f.useCallback((v,b)=>{c&&c(v,h===b?null:b)},[c,h]),O=f.useMemo(()=>({className:j.grouped,onChange:r?S:B,value:h,size:x,fullWidth:p,color:u,disabled:l}),[j.grouped,r,S,B,h,x,p,u,l]),g=le(a),y=g.length,C=v=>{const b=v===0,$=v===y-1;return b&&$?"":b?j.firstButton:$?j.lastButton:j.middleButton};return o.jsx(ue,{role:"group",className:U(j.root,i),ref:t,ownerState:T,...w,children:o.jsx(re.Provider,{value:O,children:g.map((v,b)=>o.jsx(ie.Provider,{value:C(b),children:v},b))})})});function pe({value:e,refString:s}){const[t,n]=f.useState(!1),a=f.useMemo(()=>K(s,e),[s,e]);return a!==e?o.jsxs("div",{children:[o.jsx("button",{onClick:()=>{n(!t)},children:t?"Show simplified ALT":"Show raw ALT"})," ",t?e:a]}):e}function fe({value:e}){const[s,t]=f.useState(!1),[n,a]=f.useState(!1),i=String(e);return i.length>100?o.jsxs(o.Fragment,{children:[o.jsx("button",{type:"button",onClick:()=>{Y(i),a(!0),setTimeout(()=>{a(!1)},700)},children:n?"Copied to clipboard":"Copy"}),o.jsx("button",{type:"button",onClick:()=>{t(u=>!u)},children:s?"Show less":"Show more"}),o.jsx("div",{children:s?i:`${i.slice(0,100)}...`})]}):o.jsx("div",{children:i})}function me({checked:e,disabled:s,label:t,onChange:n}){return o.jsx(q,{disabled:s,control:o.jsx(P,{checked:e,onChange:n}),label:o.jsx(N,{variant:"body2",children:t})})}function he(e){return e.toPrecision(3)}function ge({rows:e}){const[s,t]=f.useState(!1),n={};if(s)for(const l of e){const r={},p=l.GT.split(/[/|]/);for(const m of p)r[m]=(r[m]||0)+1;const c=Object.entries(r).map(([m,x])=>`${m}:${x}`).join(";");n[c]||(n[c]={count:0,GT:c,genotype:l.genotype}),n[c].count++}else for(const l of e){const r=l.GT;n[r]||(n[r]={count:0,GT:l.GT,genotype:l.genotype}),n[r].count++}const a=Object.entries(n).map(([l,r])=>({id:l,...r,count:`${r.count} / ${e.length}`,frequency:`${he(r.count/e.length*100)}%`})),u=(a[0]?Object.keys(a[0]):[]).map(l=>A.measureGridWidth(a.map(r=>`${r[l]}`)));return o.jsxs("div",{children:[o.jsx(q,{control:o.jsx(P,{checked:s}),label:o.jsx(N,{variant:"body2",children:"Use allele counts instead of exact GT"}),onChange:(l,r)=>{t(r)}}),o.jsx(_,{children:o.jsx(M,{rows:a,hideFooter:!0,rowHeight:25,columnHeaderHeight:35,columns:[{field:"GT",width:u[0]},{field:"count",width:u[1]},{field:"frequency",width:u[2]},{field:"genotype",width:u[3]}]})})]})}function xe({columns:e,filter:s,setFilter:t}){return o.jsxs(o.Fragment,{children:[o.jsx(N,{children:"These filters can use a plain text search or regex style query, e.g. in the genotype field, entering 1 will query for all genotypes that include the first alternate allele e.g. 0|1 or 1|1, entering [1-9]\\d* will find any non-zero allele e.g. 0|2 or 2/33"}),e.map(({field:n})=>o.jsx(X,{placeholder:`Filter ${n}`,value:s[n]||"",onChange:a=>{t({...s,[n]:a.target.value})}},`filter-${n}`))]})}function ve(e,s,t,n){const a=Object.entries(e).map(([r,p])=>{var c;const m=(c=p.GT)===null||c===void 0?void 0:c[0];return[r,{...p,...m?{GT:`${m}`,genotype:Z(`${m}`,s,t)}:{}}]});let i,u=[];const l=Object.keys(n);try{u=a.map(([r,p])=>({...Object.fromEntries(Object.entries(p).map(([c,m])=>[c,m])),sample:r,id:r})).filter(r=>l.length?l.every(p=>{const c=n[p];return c?new RegExp(c,"i").exec(r[p]):!0}):!0)}catch(r){console.error(r),i=r}return{rows:u,error:i}}function be(e){const{feature:s,descriptions:t={}}=e,[n,a]=f.useState({}),[i,u]=f.useState("all"),[l,r]=f.useState(!1),p=s.samples||{},c=s.ALT,m=s.REF,{rows:x,error:h}=ve(p,m,c,n),w=new Set(["sample",...Object.keys(x[0]||{})]);w.delete("id");const T=[...w],j=T.map(g=>A.measureGridWidth(x.map(y=>y[g]))),B=T.map((g,y)=>{var C,v;return{field:g,description:(v=(C=t==null?void 0:t.FORMAT)===null||C===void 0?void 0:C[g])===null||v===void 0?void 0:v.Description,width:j[y]}}),S=new Set(["sample","GT"]),O=new Set(["sample","GT","genotype"]);return x.length?o.jsxs(o.Fragment,{children:[o.jsx(D,{...e,title:"Genotype frequencies",children:o.jsx(ee.ErrorBoundary,{FallbackComponent:te.ErrorMessage,children:o.jsx(ge,{rows:x})})}),o.jsxs(D,{...e,title:"Samples",children:[h?o.jsx(N,{color:"error",children:`${h}`}):null,o.jsxs("div",{children:[o.jsx(me,{label:"Show filters",checked:l,onChange:g=>{r(g.target.checked)}}),o.jsxs(ce,{value:i,exclusive:!0,size:"small",onChange:(g,y)=>{y!==null&&u(y)},children:[o.jsx(k,{value:"all",children:"All"}),o.jsx(k,{value:"gtOnly",children:"GT only"}),o.jsx(k,{value:"genotypeOnly",children:"GT+resolved genotype"})]})]}),l?o.jsx(xe,{setFilter:a,columns:B,filter:n}):null,o.jsx(_,{children:o.jsx(M,{rows:x,hideFooter:x.length<100,columns:i==="gtOnly"?B.filter(g=>S.has(g.field)):i==="genotypeOnly"?B.filter(g=>O.has(g.field)):B,rowHeight:25,columnHeaderHeight:35,showToolbar:!0})})]})]}):null}const je={CHROM:"chromosome: An identifier from the reference genome",POS:"position: The reference position, with the 1st base having position 1",ID:"identifier: Semi-colon separated list of unique identifiers where available",REF:"reference base(s): Each base must be one of A,C,G,T,N (case insensitive).",ALT:"alternate base(s): Comma-separated list of alternate non-reference alleles",QUAL:"quality: Phred-scaled quality score for the assertion made in ALT",FILTER:"filter status: PASS if this position has passed all filters, otherwise a semicolon-separated list of codes for filters that fail"},R=f.lazy(()=>import("./LaunchBreakendPanel-DEGBoLni.js")),W=f.lazy(()=>import("./VariantConsequenceDataGrid-UVMm1KCF.js"));function ye({descriptions:e,feature:s}){var t,n,a,i,u;const l=(n=(t=e==null?void 0:e.INFO)===null||t===void 0?void 0:t.ANN)===null||n===void 0?void 0:n.Description,r=((i=(a=l==null?void 0:l.match(/.*Functional annotations:'(.*)'$/))===null||a===void 0?void 0:a[1])===null||i===void 0?void 0:i.split("|"))||[],p=((u=s.INFO)===null||u===void 0?void 0:u.ANN)||[];return o.jsx(W,{fields:r,data:p,title:"Variant ANN field"})}function Be({descriptions:e,feature:s}){var t,n,a,i,u;const l=(n=(t=e==null?void 0:e.INFO)===null||t===void 0?void 0:t.CSQ)===null||n===void 0?void 0:n.Description,r=((i=(a=l==null?void 0:l.match(/.*Format: (.*)/))===null||a===void 0?void 0:a[1])===null||i===void 0?void 0:i.split("|"))||[],p=((u=s.INFO)===null||u===void 0?void 0:u.CSQ)||[];return o.jsx(W,{fields:r,data:p,title:"Variant CSQ field"})}function Te({model:e}){const{featureData:s}=e,t=JSON.parse(JSON.stringify(s)),{type:n=""}=t;return n==="breakend"?o.jsx(R,{feature:t,locStrings:t.ALT.map(a=>{var i;return((i=ne(a))===null||i===void 0?void 0:i.MatePosition)||""}),model:e}):n==="translocation"?o.jsx(R,{feature:t,model:e,locStrings:[`${t.INFO.CHR2[0]}:${t.INFO.END}`]}):n==="paired_feature"?o.jsx(R,{feature:t,model:e,locStrings:[`${t.mate.refName}:${t.mate.start}`]}):n.includes("inversion")||n.includes("deletion")||n.includes("duplication")||n.includes("cnv")||n.includes("sv")?o.jsx(R,{feature:{uniqueId:"random",refName:t.refName,start:t.start,end:t.start+1,mate:{refName:t.refName,start:t.end,end:t.end+1}},model:e,locStrings:[`${t.refName}:${t.end}`]}):null}const Ce=E(function(e){const{feat:s,model:t}=e,{descriptions:n}=t,{samples:a,...i}=s,{REF:u}=i;return o.jsxs(oe,{"data-testid":"variant-side-drawer",children:[o.jsx(se,{feature:i,descriptions:{...je,...n},formatter:(l,r)=>r==="ALT"?o.jsx(pe,{value:`${l}`,refString:u}):o.jsx(fe,{value:l}),...e}),o.jsxs(f.Suspense,{fallback:null,children:[o.jsx(Be,{feature:i,descriptions:n}),o.jsx(ye,{feature:i,descriptions:n}),o.jsx(Te,{model:t})]}),o.jsx(be,{feature:s,...e,descriptions:n})]})}),Ee=E(function(e){const{model:s}=e,{featureData:t}=s,n=structuredClone(t);return n?o.jsx(Ce,{feat:n,...e}):o.jsx("div",{children:"No feature loaded, may not be available after page refresh because it was too large for localStorage"})});export{Ee as default};
//# sourceMappingURL=VariantFeatureWidget-DUiMDtuh.js.map
