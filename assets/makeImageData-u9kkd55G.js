import{R as J,u as G,ap as Z}from"./index-DUxFddIG.js";import{d as L,f as a,g as N,a as Q}from"./drawPhased-DvrNuell.js";async function ee({ctx:o,canvasWidth:b,canvasHeight:F,renderArgs:I}){const{renderingMode:O,minorAlleleFrequencyFilter:U,sources:d,features:V,stopToken:T,lengthCutoffFilter:X}=I,{statusCallback:z=()=>{}}=I,r=F/d.length;J.checkStopToken(T);const g=await G.updateStatus("Calculating stats",z,()=>Z({stopToken:T,features:V.values(),minorAlleleFrequencyFilter:U,lengthCutoffFilter:X}));J.checkStopToken(T);const B=[],Y=g.length,u=b/Y;return await G.updateStatus("Drawing variant matrix",z,()=>{const w={};G.forEachWithStopTokenCheck(g,T,({feature:R,mostFrequentAlt:v},H)=>{var $,E,M;const _=[];if(($=R.get("FORMAT"))===null||$===void 0?void 0:$.includes("PS")){const j=R.get("samples"),c=H/g.length*b,k=d.length;for(let s=0;s<k;s++){const i=s/k*F,{name:D,HP:K}=d[s],e=j[D];if(e){const n=(E=e.GT)===null||E===void 0?void 0:E[0];if(n){_.push(n);const p=n.includes("|");if(O==="phased")if(p){const l=(M=e.PS)===null||M===void 0?void 0:M[0],t=n.split("|");L(t,o,c,i,u,r,K,l)}else o.fillStyle="black",o.fillRect(c-a,i-a,u+a,r+a);else{const l=`${n}:${v}`;let t=w[l];if(t===void 0){let m=0,y=0,S=0,P=0;const C=n.split(/[/|]/),h=C.length;for(let f=0;f<h;f++){const A=C[f];A===v?m++:A==="0"?P++:A==="."?y++:S++}t=N(P,m,S,y,h,!0),w[l]=t}t&&Q(t,o,c,i,u,r)}}}}}else{const j=R.get("genotypes"),c=H/g.length*b,k=d.length;for(let s=0;s<k;s++){const i=s/k*F,{name:D,HP:K}=d[s],e=j[D];if(e){_.push(e);const n=e.includes("|");if(O==="phased")if(n){const p=e.split("|");L(p,o,c,i,u,r,K)}else o.fillStyle="black",o.fillRect(c-a,i-a,u+a,r+a);else{const p=`${e}:${v}`;let l=w[p];if(l===void 0){let t=0,m=0,y=0,S=0;const P=e.split(/[/|]/),C=P.length;for(let h=0;h<C;h++){const f=P[h];f===v?t++:f==="0"?S++:f==="."?m++:y++}l=N(S,t,y,m,C,!0),w[p]=l}l&&Q(l,o,c,i,u,r)}}}}B.push(_)})}),{mafs:g,arr:B}}export{ee as makeImageData};
//# sourceMappingURL=makeImageData-u9kkd55G.js.map
