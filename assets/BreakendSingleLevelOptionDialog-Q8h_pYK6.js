import{j as p,m as _,aI as F,u as k,o as B,a as w,c as C,D as O,e as P,B as y,f as R,d as D}from"./index-DUxFddIG.js";import{F as E}from"./FormControlLabel-ClCs1Dm_.js";import{C as $}from"./Checkbox-B2cvj8Wt.js";const z=_()({block:{display:"block"}});function h({checked:t,disabled:c,label:e,onChange:r}){const{classes:a}=z();return p.jsx(E,{disabled:c,className:a.block,control:p.jsx($,{checked:t,onChange:r}),label:e})}function N({feature:t,assembly:c}){var e;const r=(e=t.get("ALT"))===null||e===void 0?void 0:e[0],a=r?F(r):void 0,o=t.get("start"),l=t.get("refName"),i=n=>c.getCanonicalRefName(n)||n;if(r==="<TRA>"){const n=t.get("INFO");return{pos:o,refName:i(l),mateRefName:i(n.CHR2[0]),matePos:n.END[0]-1}}else if(a!=null&&a.MatePosition){const n=a.MatePosition.split(":");return{pos:o,refName:i(l),mateRefName:i(n[0]),matePos:+n[1]-1}}else if(t.get("mate")){const n=t.get("mate");return{pos:o,refName:i(l),mateRefName:i(n.refName),matePos:n.start}}else return{pos:o,refName:i(l),mateRefName:i(l),matePos:t.get("end")}}function j(t){return t.map(({id:c,displays:e,...r})=>({...r,displays:e.map(({id:a,...o})=>o)}))}function b(t){return`${t.get("name")||t.get("id")||"breakend"} split detail`}async function V({stableViewId:t,feature:c,assemblyName:e,session:r,mirror:a,tracks:o=[]}){const{assemblyManager:l}=r,i=await l.waitForAssembly(e);if(!i)throw new Error(`assembly ${e} not found`);const{refName:n,pos:g,mateRefName:d,matePos:f}=N({feature:c,assembly:i});let s=r.views.find(u=>u.id===t);s||(s=r.addView("BreakpointSplitView",{id:t,type:"BreakpointSplitView",displayName:b(c),views:[{type:"LinearGenomeView",hideHeader:!0,tracks:j(o)},{type:"LinearGenomeView",hideHeader:!0,tracks:j(a?[...o].reverse():o)}]})),s.setDisplayName(b(c));const v=i.regions.find(u=>u.refName===n),m=i.regions.find(u=>u.refName===d);if(!v||!m)throw new Error("can't find regions");await Promise.all([s.views[0].navToLocations([{refName:n,start:v.start,end:g,assemblyName:e},{refName:n,start:g+1,end:v.end,assemblyName:e}]),s.views[1].navToLocations([{refName:d,start:m.start,end:f,assemblyName:e},{refName:d,start:f+1,end:m.end,assemblyName:e}])]),await k.when(()=>s.views[1].initialized&&s.views[0].initialized),s.views[1].zoomTo(10),s.views[0].zoomTo(10),s.views[1].centerAt(f,d),s.views[0].centerAt(g,n)}const L=B(function({session:t,handleClose:c,feature:e,assemblyName:r,stableViewId:a,view:o}){const[l,i]=w.useState(!0),[n,g]=w.useState(!0);return p.jsxs(C.Dialog,{open:!0,onClose:c,title:"Multi-level breakpoint split view options",children:[p.jsxs(O,{children:[p.jsx("div",{children:"Launch multi-level breakpoint split view"}),o?p.jsxs(p.Fragment,{children:[p.jsx(h,{checked:l,label:"Copy tracks into the new view",onChange:d=>{i(d.target.checked)}}),l?p.jsx(h,{checked:n,disabled:!l,label:"Mirror the copied tracks (only available if copying tracks and using two level)",onChange:d=>{g(d.target.checked)}}):null]}):null]}),p.jsxs(P,{children:[p.jsx(y,{onClick:()=>{(async()=>{try{await V({stableViewId:a,session:t,tracks:l&&o?R(o.tracks):[],mirror:n,feature:e,assemblyName:r})}catch(d){console.error(d),t.notifyError(`${d}`,d)}})(),c()},variant:"contained",color:"primary",autoFocus:!0,children:"OK"}),p.jsx(y,{color:"secondary",variant:"contained",onClick:()=>{c()},children:"Cancel"})]})]})});function A({feature:t,session:c,assemblyName:e,windowSize:r=0}){const{assemblyManager:a}=c,o=a.get(e);if(!o)throw new Error(`assembly ${e} not found`);if(!o.regions)throw new Error(`assembly ${e} regions not loaded`);const l=N({feature:t,assembly:o}),{refName:i,mateRefName:n}=l,g=o.regions.find(f=>f.refName===i),d=o.regions.find(f=>f.refName===n);return{coverage:l,snap:{type:"BreakpointSplitView",views:[{type:"LinearGenomeView",displayedRegions:k.gatherOverlaps([{...g,end:l.pos+r,assemblyName:e},{...d,start:l.matePos-r,assemblyName:e}])}],displayName:b(t)}}}function G({feature:t,session:c,assemblyName:e}){const{assemblyManager:r}=c,a=r.get(e);if(!a)throw new Error(`assembly ${e} not found`);if(!a.regions)throw new Error(`assembly ${e} regions not loaded`);const o=N({feature:t,assembly:a}),{refName:l,mateRefName:i}=o,n=a.regions.find(d=>d.refName===l),g=a.regions.find(d=>d.refName===i);return{coverage:o,snap:{type:"BreakpointSplitView",views:[{type:"LinearGenomeView",displayedRegions:k.gatherOverlaps([{...n,assemblyName:e},{...g,assemblyName:e}])}],displayName:b(t)}}}async function H({stableViewId:t,feature:c,assemblyName:e,session:r,tracks:a,windowSize:o=0,focusOnBreakends:l}){var i;const{snap:n,coverage:g}=l?A({feature:c,assemblyName:e,session:r,windowSize:o}):G({feature:c,assemblyName:e,session:r}),{refName:d,pos:f,mateRefName:s,matePos:v}=g;let m=r.views.find(M=>M.id===t);m?((i=m.views[0])===null||i===void 0||i.setDisplayedRegions(n.views[0].displayedRegions),m.setDisplayName(n.displayName)):m=r.addView("BreakpointSplitView",{...n,views:[{...n.views[0],tracks:a?j(R(a)):[]}]});const u=m.views[0];await k.when(()=>u.initialized);const x=u.bpToPx({coord:Math.max(0,f-o),refName:d}),S=u.bpToPx({coord:v+o,refName:s});x&&S?u.moveTo({...x,offset:x.offsetPx},{...S,offset:S.offsetPx}):k.getSession(u).notify("Unable to navigate to breakpoint")}const T=B(function({session:t,handleClose:c,feature:e,stableViewId:r,assemblyName:a,view:o}){const[l,i]=w.useState(!0),[n,g]=w.useState(!0),[d,f]=k.useLocalStorage("breakpointWindowSize","5000");return p.jsxs(C.Dialog,{open:!0,onClose:c,title:"Single-level breakpoint split view options",children:[p.jsxs(O,{children:[o?p.jsx(h,{checked:l,label:"Copy tracks into the new view",onChange:s=>{i(s.target.checked)}}):null,p.jsx(h,{checked:l,label:"Focus on breakends",onChange:s=>{g(s.target.checked)}}),p.jsx(D,{label:"Window size (bp)",value:d,onChange:s=>{f(s.target.value)}})]}),p.jsxs(P,{children:[p.jsx(y,{onClick:()=>{(async()=>{try{const{assemblyManager:s}=t;if(!await s.waitForAssembly(a))throw new Error(`assembly ${a} not found`);await H({feature:e,assemblyName:a,focusOnBreakends:n,session:t,stableViewId:r,tracks:o==null?void 0:o.tracks,windowSize:+d||0})}catch(s){console.error(s),t.notifyError(`${s}`,s)}})(),c()},variant:"contained",color:"primary",autoFocus:!0,children:"OK"}),p.jsx(y,{color:"secondary",variant:"contained",onClick:()=>{c()},children:"Cancel"})]})]})}),U=Object.freeze(Object.defineProperty({__proto__:null,default:L},Symbol.toStringTag,{value:"Module"})),q=Object.freeze(Object.defineProperty({__proto__:null,default:T},Symbol.toStringTag,{value:"Module"})),J=Object.freeze(Object.defineProperty({__proto__:null,default:L},Symbol.toStringTag,{value:"Module"})),Q=Object.freeze(Object.defineProperty({__proto__:null,default:T},Symbol.toStringTag,{value:"Module"}));export{U as B,q as a,J as b,Q as c};
//# sourceMappingURL=BreakendSingleLevelOptionDialog-Q8h_pYK6.js.map
