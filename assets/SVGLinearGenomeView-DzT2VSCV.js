import{aD as b,j as t,u as f,bV as A,bW as N,bX as G,bY as O,bZ as z,t as E,w as $,b_ as M,c as D}from"./index-DUxFddIG.js";function F({width:e,height:s,shift:n}){const i=b();return t.jsx("rect",{width:e+n*2,height:s,fill:f.stripAlpha(i.palette.background.default)})}function H({model:e,height:s}){const{dynamicBlocks:n,offsetPx:i,interRegionPaddingWidth:l}=e;return t.jsx(t.Fragment,{children:n.contentBlocks.slice(1).map(o=>t.jsx("rect",{x:o.offsetPx-i-l,width:l,y:0,height:s,fill:"grey"},o.key))})}function L({start:e,end:s,bpPerPx:n,reversed:i=!1,major:l=!0,minor:o=!0,hideText:d=!1}){const a=A(e,s,n,l,o),h=b(),c=f.stripAlpha(h.palette.text.secondary);return t.jsxs(t.Fragment,{children:[a.map(r=>{const x=(i?s-r.base:r.base-e)/n;return t.jsx("line",{x1:x,x2:x,y1:0,y2:r.type==="major"?6:4,strokeWidth:1,stroke:c},`tick-${r.base}`)}),d?null:a.filter(r=>r.type==="major").map(r=>{const x=(i?s-r.base:r.base-e)/n;return t.jsx("text",{x:x-3,y:18,fontSize:11,fill:c,children:f.getTickDisplayStr(r.base+1,n)},`label-${r.base}`)})]})}function C({model:e,fontSize:s}){const{dynamicBlocks:{contentBlocks:n},offsetPx:i,bpPerPx:l}=e,o=n.length<5,d=b(),a=f.stripAlpha(d.palette.text.primary);return t.jsxs(t.Fragment,{children:[t.jsx(H,{model:e,height:30}),n.map(h=>{const{start:c,end:r,key:x,reversed:u,offsetPx:g,refName:m,widthPx:j}=h,p=g-i,y=`clip-${x}`;return t.jsxs("g",{children:[t.jsx("defs",{children:t.jsx("clipPath",{id:y,children:t.jsx("rect",{x:0,y:0,width:j,height:100})})}),t.jsx("g",{transform:`translate(${p} 0)`,children:t.jsxs("g",{clipPath:`url(#${y})`,children:[t.jsx("text",{x:4,y:s,fontSize:s,fill:a,children:m}),t.jsx("g",{transform:"translate(0 20)",children:t.jsx(L,{hideText:!o,start:c,end:r,bpPerPx:l,reversed:u})})]})})]},x)})]})}function I({model:e,fontSize:s}){const{offsetPx:n,dynamicBlocks:{totalWidthPxWithoutBorders:i,totalBp:l}}=e,o=b(),d=f.getBpDisplayStr(l),a=Math.max(-n,0),h=a+i,c=f.stripAlpha(o.palette.text.secondary),r=a+(h-a)/2,x=s;return t.jsxs(t.Fragment,{children:[t.jsx("line",{x1:a,x2:h,y1:10,y2:10,stroke:c}),t.jsx("line",{x1:a,x2:a,y1:5,y2:15,stroke:c}),t.jsx("line",{x1:h,x2:h,y1:5,y2:15,stroke:c}),t.jsx("text",{x:r,y:x,textAnchor:"middle",dominantBaseline:"hanging",fontSize:s,fill:c,children:d})]})}function J({model:e,fontSize:s,cytobandHeight:n,rulerHeight:i}){const{width:l,assemblyNames:o,showCytobands:d,displayedRegions:a}=e,{assemblyManager:h}=f.getSession(e),c=o.length>1?"":o[0],r=h.get(c),x=b(),u=f.stripAlpha(x.palette.text.primary),g=N.create({displayedRegions:JSON.parse(JSON.stringify(a)),interRegionPaddingWidth:0,minimumBlockWidth:e.minimumBlockWidth}),m=e.dynamicBlocks.contentBlocks;if(!m.length)return null;g.setVolatileWidth(l),g.showAllRegions();const j=g.dynamicBlocks.contentBlocks[0],p=m.at(0),y=m.at(-1),w=g.bpToPx({...p,coord:p.reversed?p.end:p.start})||0,v=g.bpToPx({...y,coord:y.reversed?y.start:y.end})||0,S=+d*n;return t.jsxs("g",{id:"header",children:[t.jsx("text",{x:0,y:0,dominantBaseline:"hanging",fontSize:s,fill:u,children:c}),d?t.jsxs("g",{transform:`translate(0 ${i})`,children:[t.jsx(G,{overview:g,assembly:r,block:j}),t.jsx("rect",{stroke:"red",fill:"rgb(255,0,0)",fillOpacity:.1,width:Math.max(v-w,.5),height:O-1,x:w,y:.5}),t.jsx("g",{transform:`translate(0,${O})`,children:t.jsx(z,{overview:g,model:e,useOffset:!1})})]}):null,t.jsx("g",{transform:`translate(0 ${s+S})`,children:t.jsx(I,{model:e,fontSize:s})}),t.jsx("g",{transform:`translate(0 ${i+S})`,children:t.jsx(C,{model:e,fontSize:s})})]})}function _({trackLabels:e,trackName:s,fontSize:n,trackLabelOffset:i,x:l}){const o=b(),d=f.stripAlpha(o.palette.text.primary),a=e==="overlay"?5:0,h=e==="offset"?5:0,c=f.coarseStripHTML(s);return e!=="none"?t.jsx("g",{children:e==="left"?t.jsx("text",{x:i-40,y:20,fill:d,fontSize:n,dominantBaseline:"hanging",textAnchor:"end",children:c}):t.jsx("text",{x:l+a,y:h,fill:d,fontSize:n,dominantBaseline:"hanging",children:c})}):null}function X({displayResults:e,model:s,textHeight:n,fontSize:i,trackLabels:l="offset",trackLabelOffset:o=0}){const d=f.getSession(s),a=l==="offset"?n:0;return t.jsx(t.Fragment,{children:e.reduce(({prevOffset:h,reactElements:c},{track:r,result:x})=>{const u=r.configuration,g=E.getTrackName(u,d),m=r.displays[0],j=Math.max(-s.offsetPx,0);return{prevOffset:h+m.height+a,reactElements:[...c,t.jsxs("g",{transform:`translate(0 ${h})`,children:[t.jsxs("g",{transform:`translate(${o} ${a})`,children:[t.jsx(H,{model:s,height:m.height}),x]}),t.jsx(_,{trackName:g,fontSize:i,trackLabels:l,trackLabelOffset:o,x:j})]},u.trackId)]}},{prevOffset:0,reactElements:[]}).reactElements})}function Y(e,s,n){return f.sum(e.map(i=>i.displays[0].height+(["none","left"].includes(n)?0:s)))}async function q(e,s){await $(()=>e.initialized);const{textHeight:n=18,headerHeight:i=40,rulerHeight:l=50,fontSize:o=13,cytobandHeight:d=100,trackLabels:a="offset",themeName:h="default",Wrapper:c=({children:k})=>k}=s,r=f.getSession(e),{allThemes:x}=r,u=x==null?void 0:x()[h],{width:g,pinnedTracks:m,unpinnedTracks:j,tracks:p,showCytobands:y}=e,w=50,v=+y*d,S=i+l+v+10,B=Y(p,n,a)+S+100,V=await Promise.all([...m,...j].map(async k=>{const R=k.displays[0];return await $(()=>!R.renderProps().notReady),{track:k,result:await R.renderSvg({...s,theme:u})}})),W=f.max(p.map(k=>f.measureText(E.getTrackName(k.configuration,r),o)),0)+40,P=a==="left"?W:0,T=g+P;return f.renderToStaticMarkup(t.jsx(M,{theme:D.createJBrowseTheme(u),children:t.jsx(c,{children:t.jsxs("svg",{width:T,height:B,xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",viewBox:[0,0,T+w*2,B].toString(),children:[t.jsx(F,{width:T,height:B,shift:w}),t.jsxs("g",{transform:`translate(${w} 0)`,children:[t.jsx("g",{transform:`translate(${P})`,children:t.jsx(J,{model:e,fontSize:o,rulerHeight:l,cytobandHeight:d})}),t.jsx("g",{transform:`translate(0 ${S})`,children:t.jsx(X,{textHeight:n,fontSize:o,model:e,displayResults:V,trackLabels:a,trackLabelOffset:P})})]})]})})}))}export{C as SVGRuler,X as SVGTracks,q as renderToSvg};
//# sourceMappingURL=SVGLinearGenomeView-DzT2VSCV.js.map
