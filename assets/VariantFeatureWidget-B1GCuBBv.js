const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./LaunchBreakendPanel-0KckMlHK.js","./index-DUxFddIG.js","./index-NjQ7mo-o.css","./BaseCard-Cs055hcc.js","./Link-u48G07Rb.js","./VariantConsequenceDataGrid-djmrerD_.js","./FormControlLabel-ClCs1Dm_.js","./Checkbox-B2cvj8Wt.js","./DataGrid-C-pLz9P0.js","./getThemeProps-Dm0Ny9BI.js","./MenuItem-BgPyIMvW.js","./dividerClasses-Dak6ZOU3.js","./Divider-j7V_EdKn.js","./Badge-BJe6riUv.js","./TableCell-KTWXPZ0I.js"])))=>i.map(i=>d[i]);
import{a as f,z as W,A as H,E as V,j as o,G as U,aS as L,H as Q,I as J,J as K,c2 as X,aX as Y,T as _,u as D,d as Z,c3 as ee,c4 as te,c as oe,o as E,P as ne,aI as re,_ as k}from"./index-DUxFddIG.js";import{F as se}from"./FeatureDetails-1Ex7WWZn.js";import{B as A}from"./BaseCard-Cs055hcc.js";import{D as P}from"./DataGridFlexContainer-CYT4HVyA.js";import{F as q}from"./FormControlLabel-ClCs1Dm_.js";import{C as I}from"./Checkbox-B2cvj8Wt.js";import{T as ie,a as ae,t as G,D as M,b as O}from"./DataGrid-C-pLz9P0.js";import"./getThemeProps-Dm0Ny9BI.js";import"./MenuItem-BgPyIMvW.js";import"./dividerClasses-Dak6ZOU3.js";import"./Divider-j7V_EdKn.js";import"./Badge-BJe6riUv.js";import"./TableCell-KTWXPZ0I.js";function le(e){return f.Children.toArray(e).filter(r=>f.isValidElement(r))}function de(e){return W("MuiToggleButtonGroup",e)}const d=H("MuiToggleButtonGroup",["root","selected","horizontal","vertical","disabled","grouped","groupedHorizontal","groupedVertical","fullWidth","firstButton","lastButton","middleButton"]),ue=e=>{const{classes:r,orientation:t,fullWidth:n,disabled:l}=e,i={root:["root",t,n&&"fullWidth"],grouped:["grouped",`grouped${L(t)}`,l&&"disabled"],firstButton:["firstButton"],lastButton:["lastButton"],middleButton:["middleButton"]};return Q(i,de,r)},ce=J("div",{name:"MuiToggleButtonGroup",slot:"Root",overridesResolver:(e,r)=>{const{ownerState:t}=e;return[{[`& .${d.grouped}`]:r.grouped},{[`& .${d.grouped}`]:r[`grouped${L(t.orientation)}`]},{[`& .${d.firstButton}`]:r.firstButton},{[`& .${d.lastButton}`]:r.lastButton},{[`& .${d.middleButton}`]:r.middleButton},r.root,t.orientation==="vertical"&&r.vertical,t.fullWidth&&r.fullWidth]}})(K(({theme:e})=>({display:"inline-flex",borderRadius:(e.vars||e).shape.borderRadius,variants:[{props:{orientation:"vertical"},style:{flexDirection:"column",[`& .${d.grouped}`]:{[`&.${d.selected} + .${d.grouped}.${d.selected}`]:{borderTop:0,marginTop:0}},[`& .${d.firstButton},& .${d.middleButton}`]:{borderBottomLeftRadius:0,borderBottomRightRadius:0},[`& .${d.lastButton},& .${d.middleButton}`]:{marginTop:-1,borderTop:"1px solid transparent",borderTopLeftRadius:0,borderTopRightRadius:0},[`& .${d.lastButton}.${G.disabled},& .${d.middleButton}.${G.disabled}`]:{borderTop:"1px solid transparent"}}},{props:{fullWidth:!0},style:{width:"100%"}},{props:{orientation:"horizontal"},style:{[`& .${d.grouped}`]:{[`&.${d.selected} + .${d.grouped}.${d.selected}`]:{borderLeft:0,marginLeft:0}},[`& .${d.firstButton},& .${d.middleButton}`]:{borderTopRightRadius:0,borderBottomRightRadius:0},[`& .${d.lastButton},& .${d.middleButton}`]:{marginLeft:-1,borderLeft:"1px solid transparent",borderTopLeftRadius:0,borderBottomLeftRadius:0},[`& .${d.lastButton}.${G.disabled},& .${d.middleButton}.${G.disabled}`]:{borderLeft:"1px solid transparent"}}}]}))),pe=f.forwardRef(function(r,t){const n=V({props:r,name:"MuiToggleButtonGroup"}),{children:l,className:i,color:u="standard",disabled:a=!1,exclusive:s=!1,fullWidth:p=!1,onChange:c,orientation:m="horizontal",size:v="medium",value:h,...w}=n,T={...n,disabled:a,fullWidth:p,orientation:m,size:v},j=ue(T),B=f.useCallback((x,b)=>{if(!c)return;const $=h&&h.indexOf(b);let F;h&&$>=0?(F=h.slice(),F.splice($,1)):F=h?h.concat(b):[b],c(x,F)},[c,h]),S=f.useCallback((x,b)=>{c&&c(x,h===b?null:b)},[c,h]),N=f.useMemo(()=>({className:j.grouped,onChange:s?S:B,value:h,size:v,fullWidth:p,color:u,disabled:a}),[j.grouped,s,S,B,h,v,p,u,a]),g=le(l),y=g.length,C=x=>{const b=x===0,$=x===y-1;return b&&$?"":b?j.firstButton:$?j.lastButton:j.middleButton};return o.jsx(ce,{role:"group",className:U(j.root,i),ref:t,ownerState:T,...w,children:o.jsx(ie.Provider,{value:N,children:g.map((x,b)=>o.jsx(ae.Provider,{value:C(b),children:x},b))})})});function fe({value:e,refString:r}){const[t,n]=f.useState(!1),l=f.useMemo(()=>X(r,e),[r,e]);return l!==e?o.jsxs("div",{children:[o.jsx("button",{onClick:()=>{n(!t)},children:t?"Show simplified ALT":"Show raw ALT"})," ",t?e:l]}):e}function me({value:e}){const[r,t]=f.useState(!1),[n,l]=f.useState(!1),i=String(e);return i.length>100?o.jsxs(o.Fragment,{children:[o.jsx("button",{type:"button",onClick:()=>{Y(i),l(!0),setTimeout(()=>{l(!1)},700)},children:n?"Copied to clipboard":"Copy"}),o.jsx("button",{type:"button",onClick:()=>{t(u=>!u)},children:r?"Show less":"Show more"}),o.jsx("div",{children:r?i:`${i.slice(0,100)}...`})]}):o.jsx("div",{children:i})}function he({checked:e,disabled:r,label:t,onChange:n}){return o.jsx(q,{disabled:r,control:o.jsx(I,{checked:e,onChange:n}),label:o.jsx(_,{variant:"body2",children:t})})}function ge(e){return e.toPrecision(3)}function ve({rows:e}){const[r,t]=f.useState(!1),n={};if(r)for(const a of e){const s={},p=a.GT.split(/[/|]/);for(const m of p)s[m]=(s[m]||0)+1;const c=Object.entries(s).map(([m,v])=>`${m}:${v}`).join(";");n[c]||(n[c]={count:0,GT:c,genotype:a.genotype}),n[c].count++}else for(const a of e){const s=a.GT;n[s]||(n[s]={count:0,GT:a.GT,genotype:a.genotype}),n[s].count++}const l=Object.entries(n).map(([a,s])=>({id:a,...s,count:`${s.count} / ${e.length}`,frequency:`${ge(s.count/e.length*100)}%`})),u=(l[0]?Object.keys(l[0]):[]).map(a=>D.measureGridWidth(l.map(s=>`${s[a]}`)));return o.jsxs("div",{children:[o.jsx(q,{control:o.jsx(I,{checked:r}),label:o.jsx(_,{variant:"body2",children:"Use allele counts instead of exact GT"}),onChange:(a,s)=>{t(s)}}),o.jsx(P,{children:o.jsx(M,{rows:l,hideFooter:!0,rowHeight:25,columnHeaderHeight:35,columns:[{field:"GT",width:u[0]},{field:"count",width:u[1]},{field:"frequency",width:u[2]},{field:"genotype",width:u[3]}]})})]})}function xe({columns:e,filter:r,setFilter:t}){return o.jsxs(o.Fragment,{children:[o.jsx(_,{children:"These filters can use a plain text search or regex style query, e.g. in the genotype field, entering 1 will query for all genotypes that include the first alternate allele e.g. 0|1 or 1|1, entering [1-9]\\d* will find any non-zero allele e.g. 0|2 or 2/33"}),e.map(({field:n})=>o.jsx(Z,{placeholder:`Filter ${n}`,value:r[n]||"",onChange:l=>{t({...r,[n]:l.target.value})}},`filter-${n}`))]})}function be(e,r,t,n){const l=Object.entries(e).map(([s,p])=>{var c;const m=(c=p.GT)===null||c===void 0?void 0:c[0];return[s,{...p,...m?{GT:`${m}`,genotype:ee(`${m}`,r,t)}:{}}]});let i,u=[];const a=Object.keys(n);try{u=l.map(([s,p])=>({...Object.fromEntries(Object.entries(p).map(([c,m])=>[c,m])),sample:s,id:s})).filter(s=>a.length?a.every(p=>{const c=n[p];return c?new RegExp(c,"i").exec(s[p]):!0}):!0)}catch(s){console.error(s),i=s}return{rows:u,error:i}}function je(e){const{feature:r,descriptions:t={}}=e,[n,l]=f.useState({}),[i,u]=f.useState("all"),[a,s]=f.useState(!1),p=r.samples||{},c=r.ALT,m=r.REF,{rows:v,error:h}=be(p,m,c,n),w=new Set(["sample",...Object.keys(v[0]||{})]);w.delete("id");const T=[...w],j=T.map(g=>D.measureGridWidth(v.map(y=>y[g]))),B=T.map((g,y)=>{var C,x;return{field:g,description:(x=(C=t==null?void 0:t.FORMAT)===null||C===void 0?void 0:C[g])===null||x===void 0?void 0:x.Description,width:j[y]}}),S=new Set(["sample","GT"]),N=new Set(["sample","GT","genotype"]);return v.length?o.jsxs(o.Fragment,{children:[o.jsx(A,{...e,title:"Genotype frequencies",children:o.jsx(te.ErrorBoundary,{FallbackComponent:oe.ErrorMessage,children:o.jsx(ve,{rows:v})})}),o.jsxs(A,{...e,title:"Samples",children:[h?o.jsx(_,{color:"error",children:`${h}`}):null,o.jsxs("div",{children:[o.jsx(he,{label:"Show filters",checked:a,onChange:g=>{s(g.target.checked)}}),o.jsxs(pe,{value:i,exclusive:!0,size:"small",onChange:(g,y)=>{y!==null&&u(y)},children:[o.jsx(O,{value:"all",children:"All"}),o.jsx(O,{value:"gtOnly",children:"GT only"}),o.jsx(O,{value:"genotypeOnly",children:"GT+resolved genotype"})]})]}),a?o.jsx(xe,{setFilter:l,columns:B,filter:n}):null,o.jsx(P,{children:o.jsx(M,{rows:v,hideFooter:v.length<100,columns:i==="gtOnly"?B.filter(g=>S.has(g.field)):i==="genotypeOnly"?B.filter(g=>N.has(g.field)):B,rowHeight:25,columnHeaderHeight:35,showToolbar:!0})})]})]}):null}const ye={CHROM:"chromosome: An identifier from the reference genome",POS:"position: The reference position, with the 1st base having position 1",ID:"identifier: Semi-colon separated list of unique identifiers where available",REF:"reference base(s): Each base must be one of A,C,G,T,N (case insensitive).",ALT:"alternate base(s): Comma-separated list of alternate non-reference alleles",QUAL:"quality: Phred-scaled quality score for the assertion made in ALT",FILTER:"filter status: PASS if this position has passed all filters, otherwise a semicolon-separated list of codes for filters that fail"},R=f.lazy(()=>k(()=>import("./LaunchBreakendPanel-0KckMlHK.js"),__vite__mapDeps([0,1,2,3,4]),import.meta.url)),z=f.lazy(()=>k(()=>import("./VariantConsequenceDataGrid-djmrerD_.js"),__vite__mapDeps([5,1,2,3,6,7,8,9,10,11,12,13,14]),import.meta.url));function Be({descriptions:e,feature:r}){var t,n,l,i,u;const a=(n=(t=e==null?void 0:e.INFO)===null||t===void 0?void 0:t.ANN)===null||n===void 0?void 0:n.Description,s=((i=(l=a==null?void 0:a.match(/.*Functional annotations:'(.*)'$/))===null||l===void 0?void 0:l[1])===null||i===void 0?void 0:i.split("|"))||[],p=((u=r.INFO)===null||u===void 0?void 0:u.ANN)||[];return o.jsx(z,{fields:s,data:p,title:"Variant ANN field"})}function Te({descriptions:e,feature:r}){var t,n,l,i,u;const a=(n=(t=e==null?void 0:e.INFO)===null||t===void 0?void 0:t.CSQ)===null||n===void 0?void 0:n.Description,s=((i=(l=a==null?void 0:a.match(/.*Format: (.*)/))===null||l===void 0?void 0:l[1])===null||i===void 0?void 0:i.split("|"))||[],p=((u=r.INFO)===null||u===void 0?void 0:u.CSQ)||[];return o.jsx(z,{fields:s,data:p,title:"Variant CSQ field"})}function Ce({model:e}){const{featureData:r}=e,t=JSON.parse(JSON.stringify(r)),{type:n=""}=t;return n==="breakend"?o.jsx(R,{feature:t,locStrings:t.ALT.map(l=>{var i;return((i=re(l))===null||i===void 0?void 0:i.MatePosition)||""}),model:e}):n==="translocation"?o.jsx(R,{feature:t,model:e,locStrings:[`${t.INFO.CHR2[0]}:${t.INFO.END}`]}):n==="paired_feature"?o.jsx(R,{feature:t,model:e,locStrings:[`${t.mate.refName}:${t.mate.start}`]}):n.includes("inversion")||n.includes("deletion")||n.includes("duplication")||n.includes("cnv")||n.includes("sv")?o.jsx(R,{feature:{uniqueId:"random",refName:t.refName,start:t.start,end:t.start+1,mate:{refName:t.refName,start:t.end,end:t.end+1}},model:e,locStrings:[`${t.refName}:${t.end}`]}):null}const $e=E(function(e){const{feat:r,model:t}=e,{descriptions:n}=t,{samples:l,...i}=r,{REF:u}=i;return o.jsxs(ne,{"data-testid":"variant-side-drawer",children:[o.jsx(se,{feature:i,descriptions:{...ye,...n},formatter:(a,s)=>s==="ALT"?o.jsx(fe,{value:`${a}`,refString:u}):o.jsx(me,{value:a}),...e}),o.jsxs(f.Suspense,{fallback:null,children:[o.jsx(Te,{feature:i,descriptions:n}),o.jsx(Be,{feature:i,descriptions:n}),o.jsx(Ce,{model:t})]}),o.jsx(je,{feature:r,...e,descriptions:n})]})}),Pe=E(function(e){const{model:r}=e,{featureData:t}=r,n=structuredClone(t);return n?o.jsx($e,{feat:n,...e}):o.jsx("div",{children:"No feature loaded, may not be available after page refresh because it was too large for localStorage"})});export{Pe as default};
//# sourceMappingURL=VariantFeatureWidget-B1GCuBBv.js.map
