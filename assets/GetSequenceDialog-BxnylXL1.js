import{h as L,j as e,u as F,d as I,o as M,r as c,c as q,I as O,K as T,M as D,J as _,L as G,b as j,bB as z,aY as B,aX as H,m as P}from"./rpcWorker-X0469dqW.js";import{F as N}from"./FormControlLabel-1s92K5sy.js";import{C as R}from"./Checkbox-CZRpP34h.js";var f={},k;function W(){if(k)return f;k=1,Object.defineProperty(f,"__esModule",{value:!0}),f.formatFastaLines=s,f.formatSeqFasta=a;function s(n){return n.replaceAll(/(.{1,80})/g,`$1
`).trimEnd()}function a(n){return n.map(o=>`>${o.header}
${s(o.seq)}`).join(`
`)}return f}var J=W(),K=L(e.jsx("path",{d:"M19 9h-4V3H9v6H5l7 7zM5 18v2h14v-2z"}));async function V(s,a){const n=F.getSession(s),{leftOffset:o,rightOffset:m}=s;if(!o||!m)throw new Error("no offsets on model to use for range");if(new Set(a.map(b=>b.assemblyName)).size>1)throw new Error("not able to fetch sequences from multiple assemblies currently");const{rpcManager:x,assemblyManager:i}=n,g=o.assemblyName||m.assemblyName||"",p=i.get(g);if(!p)throw new Error(`assembly ${g} not found`);const h=I.getConf(p,["sequence","adapter"]),l="getSequence";return x.call(l,"CoreGetFeatures",{adapterConfig:h,regions:a,sessionId:l})}const X=P()({dialogContent:{width:"80em"},textAreaFont:{fontFamily:"Courier New"},ml:{marginLeft:10}}),Z=M(function({model:s,handleClose:a}){const{classes:n}=X(),[o,m]=c.useState(),[d,x]=c.useState(),[i,g]=c.useState(!1),[p,h]=c.useState(!1),[l,b]=c.useState(!1),{leftOffset:w,rightOffset:E}=s,S=d===void 0;c.useEffect(()=>{const r=new AbortController;return(async()=>{try{const t=s.getSelectedRegions(w,E);if(t.length===0)throw new Error("Selected region is out of bounds");x(await V(s,t))}catch(t){console.error(t),m(t)}})(),()=>{r.abort()}},[s,w,E]);const u=d?J.formatSeqFasta(d.map(r=>{let t=r.get("seq");const $=r.get("refName"),v=r.get("start")+1,C=r.get("end"),A=`${$}:${v}-${C}`;if((t==null?void 0:t.length)!==C-v+1)throw new Error(`${A} returned ${t.length.toLocaleString()} bases, but should have returned ${(C-v).toLocaleString()}`);return i&&(t=F.reverse(t)),l&&(t=F.complement(t)),{header:A+(i?"-rev":"")+(l?"-comp":""),seq:t}})):"",y=u?u.length>1e6:!1;return e.jsxs(q.Dialog,{maxWidth:"xl",open:!0,onClose:()=>{a(),s.setOffsets()},title:"Reference sequence",children:[e.jsxs(O,{children:[o?e.jsx(q.ErrorMessage,{error:o}):S?e.jsx(q.LoadingEllipses,{message:"Retrieving sequences"}):null,e.jsx(T,{"data-testid":"rubberband-sequence",variant:"outlined",multiline:!0,minRows:5,maxRows:10,disabled:y,className:n.dialogContent,fullWidth:!0,value:y?"Reference sequence too large to display, use the download FASTA button":u,slotProps:{input:{readOnly:!0,classes:{input:n.textAreaFont}}}}),e.jsxs(D,{children:[e.jsx(N,{control:e.jsx(R,{value:i,onChange:r=>{g(r.target.checked)}}),label:"Reverse sequence"}),e.jsx(N,{control:e.jsx(R,{value:l,onChange:r=>{b(r.target.checked)}}),label:"Complement sequence"})]}),e.jsx(_,{style:{margin:10},children:'Note: Check both boxes for the "reverse complement"'})]}),e.jsxs(G,{children:[e.jsx(j,{onClick:()=>{B(u),h(!0),setTimeout(()=>{h(!1)},500)},disabled:S||!!o||y,color:"primary",startIcon:e.jsx(z,{}),children:p?"Copied":"Copy to clipboard"}),e.jsx(j,{onClick:()=>{H.saveAs(new Blob([u||""],{type:"text/x-fasta;charset=utf-8"}),"jbrowse_ref_seq.fa")},disabled:S||!!o,color:"primary",startIcon:e.jsx(K,{}),children:"Download FASTA"}),e.jsx(j,{onClick:a,variant:"contained",children:"Close"})]})]})});export{Z as default};
//# sourceMappingURL=GetSequenceDialog-BxnylXL1.js.map
