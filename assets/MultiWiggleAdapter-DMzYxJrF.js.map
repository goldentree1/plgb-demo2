{"version":3,"file":"MultiWiggleAdapter-DMzYxJrF.js","sources":["../node_modules/@jbrowse/plugin-wiggle/esm/MultiWiggleAdapter/MultiWiggleAdapter.js"],"sourcesContent":["import { BaseFeatureDataAdapter } from '@jbrowse/core/data_adapters/BaseAdapter';\nimport { SimpleFeature, max, min } from '@jbrowse/core/util';\nimport { ObservableCreate } from '@jbrowse/core/util/rxjs';\nimport { merge } from 'rxjs';\nimport { map } from 'rxjs/operators';\nfunction getFilename(uri) {\n    const filename = uri.slice(uri.lastIndexOf('/') + 1);\n    return filename.slice(0, filename.lastIndexOf('.'));\n}\nfunction getFilenameFromAdapterConfig(config) {\n    try {\n        if (config.type === 'BigWigAdapter' && config.bigWigLocation) {\n            const location = config.bigWigLocation;\n            if ('uri' in location && location.uri) {\n                return getFilename(location.uri);\n            }\n            if ('localPath' in location && location.localPath) {\n                return getFilename(location.localPath);\n            }\n            if ('blob' in location && location.blob) {\n                const blob = location.blob;\n                return blob.name ? getFilename(blob.name) : undefined;\n            }\n        }\n        return undefined;\n    }\n    catch (e) {\n        return undefined;\n    }\n}\nclass MultiWiggleAdapter extends BaseFeatureDataAdapter {\n    async getAdapters() {\n        const getSubAdapter = this.getSubAdapter;\n        if (!getSubAdapter) {\n            throw new Error('no getSubAdapter available');\n        }\n        let subConfs = this.getConf('subadapters');\n        if (!(subConfs === null || subConfs === void 0 ? void 0 : subConfs.length)) {\n            const entries = this.getConf('bigWigs');\n            subConfs = entries.map(entry => ({\n                type: 'BigWigAdapter',\n                source: getFilename(entry),\n                bigWigLocation: {\n                    uri: entry,\n                },\n            }));\n        }\n        const ret = await Promise.all(subConfs.map(async (conf) => {\n            const dataAdapter = (await getSubAdapter(conf))\n                .dataAdapter;\n            const source = conf.source ||\n                conf.name ||\n                getFilenameFromAdapterConfig(conf) ||\n                dataAdapter.id;\n            return {\n                ...conf,\n                dataAdapter,\n                source,\n            };\n        }));\n        return ret;\n    }\n    async getRefNames(opts) {\n        const adapters = await this.getAdapters();\n        const allNames = await Promise.all(adapters.map(a => a.dataAdapter.getRefNames(opts)));\n        return [...new Set(allNames.flat())];\n    }\n    async getGlobalStats(opts) {\n        const adapters = await this.getAdapters();\n        const stats = (await Promise.all(adapters.map(adp => { var _a, _b; return (_b = (_a = adp.dataAdapter).getGlobalStats) === null || _b === void 0 ? void 0 : _b.call(_a, opts); }))).filter(f => !!f);\n        return {\n            scoreMin: min(stats.map(s => s.scoreMin)),\n            scoreMax: max(stats.map(s => s.scoreMax)),\n        };\n    }\n    getFeatures(region, opts = {}) {\n        return ObservableCreate(async (observer) => {\n            const adapters = await this.getAdapters();\n            merge(...adapters.map(adp => adp.dataAdapter.getFeatures(region, opts).pipe(map(p => p.get('source')\n                ? p\n                : new SimpleFeature({\n                    ...p.toJSON(),\n                    uniqueId: `${adp.source}-${p.id()}`,\n                    source: adp.source,\n                }))))).subscribe(observer);\n        }, opts.stopToken);\n    }\n    async getMultiRegionFeatureDensityStats(_regions) {\n        return {\n            featureDensity: 0,\n        };\n    }\n    async getSources(_regions) {\n        const adapters = await this.getAdapters();\n        return adapters.map(({ type, bigWigLocation, dataAdapter, ...rest }) => {\n            return {\n                ...rest,\n                name: rest.source,\n            };\n        });\n    }\n}\nMultiWiggleAdapter.capabilities = [\n    'hasResolution',\n    'hasLocalStats',\n    'hasGlobalStats',\n];\nexport default MultiWiggleAdapter;\n"],"names":["getFilename","uri","filename","getFilenameFromAdapterConfig","config","location","blob","MultiWiggleAdapter","BaseFeatureDataAdapter","getSubAdapter","subConfs","entry","conf","dataAdapter","source","opts","adapters","allNames","a","stats","adp","_a","_b","f","min","s","max","region","ObservableCreate","observer","merge","map","p","SimpleFeature","_regions","type","bigWigLocation","rest"],"mappings":"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","x_google_ignoreList":[0]}