{"version":3,"file":"makeImage-Ci0NpDDK.js","sources":["../node_modules/@jbrowse/plugin-alignments/esm/SNPCoverageRenderer/makeImage.js"],"sourcesContent":["import { readConfObject } from '@jbrowse/core/configuration';\nimport { createJBrowseTheme } from '@jbrowse/core/ui';\nimport { bpSpanPx, featureSpanPx, forEachWithStopTokenCheck, } from '@jbrowse/core/util';\nimport { YSCALEBAR_LABEL_OFFSET, getOrigin, getScale, } from '@jbrowse/plugin-wiggle';\nimport { alphaColor } from '../shared/util';\nconst INTERBASE_INDICATOR_WIDTH = 7;\nconst INTERBASE_INDICATOR_HEIGHT = 4.5;\nconst MINIMUM_INTERBASE_INDICATOR_READ_DEPTH = 7;\nconst complementBase = {\n    C: 'G',\n    G: 'C',\n    A: 'T',\n    T: 'A',\n};\nconst fudgeFactor = 0.6;\nfunction calculateModificationCounts({ base, isSimplex, refbase, snps, ref, score0, }) {\n    var _a, _b, _c, _d;\n    if (base === 'N') {\n        return { modifiable: score0, detectable: score0 };\n    }\n    const cmp = complementBase[base];\n    const baseCount = (((_a = snps[base]) === null || _a === void 0 ? void 0 : _a.entryDepth) || 0) + (refbase === base ? ref.entryDepth : 0);\n    const complCount = (((_b = snps[cmp]) === null || _b === void 0 ? void 0 : _b.entryDepth) || 0) + (refbase === cmp ? ref.entryDepth : 0);\n    const modifiable = baseCount + complCount;\n    const detectable = isSimplex\n        ? (((_c = snps[base]) === null || _c === void 0 ? void 0 : _c['1']) || 0) +\n            (((_d = snps[cmp]) === null || _d === void 0 ? void 0 : _d['-1']) || 0) +\n            (refbase === base ? ref['1'] : 0) +\n            (refbase === cmp ? ref['-1'] : 0)\n        : modifiable;\n    return { modifiable, detectable };\n}\nexport async function makeImage(ctx, props) {\n    var _a;\n    const { features, regions, bpPerPx, colorBy, displayCrossHatches, visibleModifications = {}, simplexModifications = [], scaleOpts, height: unadjustedHeight, theme: configTheme, config: cfg, ticks, stopToken, } = props;\n    const theme = createJBrowseTheme(configTheme);\n    const region = regions[0];\n    const width = (region.end - region.start) / bpPerPx;\n    const offset = YSCALEBAR_LABEL_OFFSET;\n    const height = unadjustedHeight - offset * 2;\n    const opts = { ...scaleOpts, range: [0, height] };\n    const viewScale = getScale(opts);\n    const indicatorViewScale = getScale({\n        ...opts,\n        range: [0, height / 2],\n        scaleType: 'linear',\n    });\n    const originY = getOrigin(scaleOpts.scaleType);\n    const originLinear = getOrigin('linear');\n    const indicatorThreshold = readConfObject(cfg, 'indicatorThreshold');\n    const showInterbaseCounts = readConfObject(cfg, 'showInterbaseCounts');\n    const showArcs = readConfObject(cfg, 'showArcs');\n    const showInterbaseIndicators = readConfObject(cfg, 'showInterbaseIndicators');\n    const toY = (n) => height - (viewScale(n) || 0) + offset;\n    const toHeight = (n) => toY(originY) - toY(n);\n    const toY2 = (n) => height - (indicatorViewScale(n) || 0) + offset;\n    const toHeight2 = (n) => toY2(originLinear) - toY2(n);\n    const { bases, softclip, hardclip, insertion } = theme.palette;\n    const colorMap = {\n        A: bases.A.main,\n        C: bases.C.main,\n        G: bases.G.main,\n        T: bases.T.main,\n        insertion,\n        softclip,\n        hardclip,\n        total: readConfObject(cfg, 'color'),\n        mod_NONE: 'blue',\n        cpg_meth: 'red',\n        cpg_unmeth: 'blue',\n    };\n    ctx.fillStyle = colorMap.total;\n    forEachWithStopTokenCheck(features.values(), stopToken, feature => {\n        if (feature.get('type') === 'skip') {\n            return;\n        }\n        const [leftPx, rightPx] = featureSpanPx(feature, region, bpPerPx);\n        const w = rightPx - leftPx + fudgeFactor;\n        const score = feature.get('score');\n        ctx.fillRect(leftPx, toY(score), w, toHeight(score));\n    });\n    let prevTotal = 0;\n    const extraHorizontallyFlippedOffset = region.reversed ? 1 / bpPerPx : 0;\n    const drawingModifications = colorBy.type === 'modifications';\n    const drawingMethylation = colorBy.type === 'methylation';\n    const isolatedModification = (_a = colorBy.modifications) === null || _a === void 0 ? void 0 : _a.isolatedModification;\n    const simplexSet = new Set(simplexModifications);\n    forEachWithStopTokenCheck(features.values(), stopToken, feature => {\n        var _a;\n        if (feature.get('type') === 'skip') {\n            return;\n        }\n        const [leftPx, rightPx] = featureSpanPx(feature, region, bpPerPx);\n        const snpinfo = feature.get('snpinfo');\n        const w = Math.max(rightPx - leftPx, 1);\n        const score0 = feature.get('score');\n        if (drawingModifications) {\n            let curr = 0;\n            const refbase = (_a = snpinfo.refbase) === null || _a === void 0 ? void 0 : _a.toUpperCase();\n            const { nonmods, mods, snps, ref } = snpinfo;\n            const nonmodKeys = Object.keys(nonmods).sort().reverse();\n            for (const m of nonmodKeys) {\n                const modKey = m.replace(/^(nonmod_|mod_)/, '');\n                const mod = visibleModifications[modKey];\n                if (!mod) {\n                    console.warn(`${m} not known yet`);\n                    continue;\n                }\n                if (isolatedModification && mod.type !== isolatedModification) {\n                    continue;\n                }\n                const { modifiable, detectable } = calculateModificationCounts({\n                    base: mod.base,\n                    isSimplex: simplexSet.has(mod.type),\n                    refbase,\n                    snps,\n                    ref,\n                    score0,\n                });\n                const { entryDepth, avgProbability = 0 } = snpinfo.nonmods[m];\n                const modFraction = (modifiable / score0) * (entryDepth / detectable);\n                const nonModColor = 'blue';\n                const c = alphaColor(nonModColor, avgProbability);\n                const height = toHeight(score0);\n                const bottom = toY(score0) + height;\n                ctx.fillStyle = c;\n                ctx.fillRect(Math.round(leftPx), bottom - (curr + modFraction * height), w, modFraction * height);\n                curr += modFraction * height;\n            }\n            const modKeys = Object.keys(mods).sort().reverse();\n            for (const m of modKeys) {\n                const modKey = m.replace('mod_', '');\n                const mod = visibleModifications[modKey];\n                if (!mod) {\n                    console.warn(`${m} not known yet`);\n                    continue;\n                }\n                if (isolatedModification && mod.type !== isolatedModification) {\n                    continue;\n                }\n                const { modifiable, detectable } = calculateModificationCounts({\n                    base: mod.base,\n                    isSimplex: simplexSet.has(mod.type),\n                    refbase,\n                    snps,\n                    ref,\n                    score0,\n                });\n                const { entryDepth, avgProbability = 0 } = mods[m];\n                const modFraction = (modifiable / score0) * (entryDepth / detectable);\n                const baseColor = mod.color || 'black';\n                const c = alphaColor(baseColor, avgProbability);\n                const height = toHeight(score0);\n                const bottom = toY(score0) + height;\n                ctx.fillStyle = c;\n                ctx.fillRect(Math.round(leftPx), bottom - (curr + modFraction * height), w, modFraction * height);\n                curr += modFraction * height;\n            }\n        }\n        else if (drawingMethylation) {\n            const { depth, nonmods, mods } = snpinfo;\n            let curr = 0;\n            for (const base of Object.keys(mods).sort().reverse()) {\n                const { entryDepth } = mods[base];\n                const height = toHeight(score0);\n                const bottom = toY(score0) + height;\n                ctx.fillStyle = colorMap[base] || 'black';\n                ctx.fillRect(Math.round(leftPx), bottom - ((entryDepth + curr) / depth) * height, w, (entryDepth / depth) * height);\n                curr += entryDepth;\n            }\n            for (const base of Object.keys(nonmods).sort().reverse()) {\n                const { entryDepth } = nonmods[base];\n                const height = toHeight(score0);\n                const bottom = toY(score0) + height;\n                ctx.fillStyle = colorMap[base] || 'black';\n                ctx.fillRect(Math.round(leftPx), bottom - ((entryDepth + curr) / depth) * height, w, (entryDepth / depth) * height);\n                curr += entryDepth;\n            }\n        }\n        else {\n            const { depth, snps } = snpinfo;\n            let curr = 0;\n            for (const base of Object.keys(snps).sort().reverse()) {\n                const { entryDepth } = snps[base];\n                const height = toHeight(score0);\n                const bottom = toY(score0) + height;\n                ctx.fillStyle = colorMap[base] || 'black';\n                ctx.fillRect(Math.round(leftPx), bottom - ((entryDepth + curr) / depth) * height, w, (entryDepth / depth) * height);\n                curr += entryDepth;\n            }\n        }\n        const interbaseEvents = Object.keys(snpinfo.noncov);\n        if (showInterbaseCounts) {\n            let curr = 0;\n            for (const base of interbaseEvents) {\n                const { entryDepth } = snpinfo.noncov[base];\n                const r = 0.6;\n                ctx.fillStyle = colorMap[base];\n                ctx.fillRect(leftPx - r + extraHorizontallyFlippedOffset, INTERBASE_INDICATOR_HEIGHT + toHeight2(curr), r * 2, toHeight2(entryDepth));\n                curr += entryDepth;\n            }\n        }\n        if (showInterbaseIndicators) {\n            let accum = 0;\n            let max = 0;\n            let maxBase = '';\n            for (const base of interbaseEvents) {\n                const { entryDepth } = snpinfo.noncov[base];\n                accum += entryDepth;\n                if (entryDepth > max) {\n                    max = entryDepth;\n                    maxBase = base;\n                }\n            }\n            const indicatorComparatorScore = Math.max(score0, prevTotal);\n            if (accum > indicatorComparatorScore * indicatorThreshold &&\n                indicatorComparatorScore > MINIMUM_INTERBASE_INDICATOR_READ_DEPTH) {\n                ctx.fillStyle = colorMap[maxBase];\n                ctx.beginPath();\n                const l = leftPx + extraHorizontallyFlippedOffset;\n                ctx.moveTo(l - INTERBASE_INDICATOR_WIDTH / 2, 0);\n                ctx.lineTo(l + INTERBASE_INDICATOR_WIDTH / 2, 0);\n                ctx.lineTo(l, INTERBASE_INDICATOR_HEIGHT);\n                ctx.fill();\n            }\n        }\n        prevTotal = score0;\n    });\n    if (showArcs) {\n        forEachWithStopTokenCheck(features.values(), stopToken, feature => {\n            if (feature.get('type') !== 'skip') {\n                return;\n            }\n            const s = feature.get('start');\n            const e = feature.get('end');\n            const [left, right] = bpSpanPx(s, e, region, bpPerPx);\n            ctx.beginPath();\n            const effectiveStrand = feature.get('effectiveStrand');\n            const pos = 'rgba(255,200,200,0.7)';\n            const neg = 'rgba(200,200,255,0.7)';\n            const neutral = 'rgba(200,200,200,0.7)';\n            if (effectiveStrand === 1) {\n                ctx.strokeStyle = pos;\n            }\n            else if (effectiveStrand === -1) {\n                ctx.strokeStyle = neg;\n            }\n            else {\n                ctx.strokeStyle = neutral;\n            }\n            ctx.lineWidth = Math.log(feature.get('score') + 1);\n            ctx.moveTo(left, height - offset * 2);\n            ctx.bezierCurveTo(left, 0, right, 0, right, height - offset * 2);\n            ctx.stroke();\n        });\n    }\n    if (displayCrossHatches) {\n        ctx.lineWidth = 1;\n        ctx.strokeStyle = 'rgba(140,140,140,0.8)';\n        for (const tick of ticks.values) {\n            ctx.beginPath();\n            ctx.moveTo(0, Math.round(toY(tick)));\n            ctx.lineTo(width, Math.round(toY(tick)));\n            ctx.stroke();\n        }\n    }\n}\n"],"names":["INTERBASE_INDICATOR_WIDTH","INTERBASE_INDICATOR_HEIGHT","MINIMUM_INTERBASE_INDICATOR_READ_DEPTH","complementBase","fudgeFactor","calculateModificationCounts","base","isSimplex","refbase","snps","ref","score0","_a","_b","_c","_d","cmp","baseCount","complCount","modifiable","detectable","makeImage","ctx","props","features","regions","bpPerPx","colorBy","displayCrossHatches","visibleModifications","simplexModifications","scaleOpts","unadjustedHeight","configTheme","cfg","ticks","stopToken","theme","createJBrowseTheme","region","width","offset","YSCALEBAR_LABEL_OFFSET","height","opts","viewScale","getScale","indicatorViewScale","originY","getOrigin","originLinear","indicatorThreshold","readConfObject","showInterbaseCounts","showArcs","showInterbaseIndicators","toY","n","toHeight","toY2","toHeight2","bases","softclip","hardclip","insertion","colorMap","forEachWithStopTokenCheck","feature","leftPx","rightPx","featureSpanPx","w","score","prevTotal","extraHorizontallyFlippedOffset","drawingModifications","drawingMethylation","isolatedModification","simplexSet","snpinfo","curr","nonmods","mods","nonmodKeys","m","modKey","mod","entryDepth","avgProbability","modFraction","c","alphaColor","bottom","modKeys","baseColor","depth","interbaseEvents","r","accum","max","maxBase","indicatorComparatorScore","l","s","e","left","right","bpSpanPx","effectiveStrand","pos","neg","neutral","tick"],"mappings":"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","x_google_ignoreList":[0]}