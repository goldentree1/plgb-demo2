import{M as G,u as H,a4 as N}from"./index-DUxFddIG.js";/*!
 * is-primitive <https://github.com/jonschlinkert/is-primitive>
 *
 * Copyright (c) 2014-present, Jon Schlinkert.
 * Released under the MIT License.
 */var q,_;function X(){return _||(_=1,q=function(t){return typeof t=="object"?t===null:typeof t!="function"}),q}/*!
 * isobject <https://github.com/jonschlinkert/isobject>
 *
 * Copyright (c) 2014-2017, Jon Schlinkert.
 * Released under the MIT License.
 */var J,E;function Y(){return E||(E=1,J=function(t){return t!=null&&typeof t=="object"&&Array.isArray(t)===!1}),J}/*!
 * is-plain-object <https://github.com/jonschlinkert/is-plain-object>
 *
 * Copyright (c) 2014-2017, Jon Schlinkert.
 * Released under the MIT License.
 */var F,L;function Q(){if(L)return F;L=1;var e=Y();function t(r){return e(r)===!0&&Object.prototype.toString.call(r)==="[object Object]"}return F=function(s){var n,i;return!(t(s)===!1||(n=s.constructor,typeof n!="function")||(i=n.prototype,t(i)===!1)||i.hasOwnProperty("isPrototypeOf")===!1)},F}/*!
 * set-value <https://github.com/jonschlinkert/set-value>
 *
 * Copyright (c) Jon Schlinkert (https://github.com/jonschlinkert).
 * Released under the MIT License.
 */var x,I;function Z(){if(I)return x;I=1;const{deleteProperty:e}=Reflect,t=X(),r=Q(),s=o=>typeof o=="object"&&o!==null||typeof o=="function",n=o=>o==="__proto__"||o==="constructor"||o==="prototype",i=o=>{if(!t(o))throw new TypeError("Object keys must be strings or symbols");if(n(o))throw new Error(`Cannot set unsafe key: "${o}"`)},m=o=>Array.isArray(o)?o.flat().map(String).join(","):o,S=(o,a)=>{if(typeof o!="string"||!a)return o;let d=o+";";return a.arrays!==void 0&&(d+=`arrays=${a.arrays};`),a.separator!==void 0&&(d+=`separator=${a.separator};`),a.split!==void 0&&(d+=`split=${a.split};`),a.merge!==void 0&&(d+=`merge=${a.merge};`),a.preservePaths!==void 0&&(d+=`preservePaths=${a.preservePaths};`),d},l=(o,a,d)=>{const p=m(a?S(o,a):o);i(p);const b=f.cache.get(p)||d();return f.cache.set(p,b),b},u=(o,a={})=>{const d=a.separator||".",p=d==="/"?!1:a.preservePaths;if(typeof o=="string"&&p!==!1&&/\//.test(o))return[o];const b=[];let h="";const k=y=>{let j;y.trim()!==""&&Number.isInteger(j=Number(y))?b.push(j):b.push(y)};for(let y=0;y<o.length;y++){const j=o[y];if(j==="\\"){h+=o[++y];continue}if(j===d){k(h),h="";continue}h+=j}return h&&k(h),b},c=(o,a)=>a&&typeof a.split=="function"?a.split(o):typeof o=="symbol"?[o]:Array.isArray(o)?o:l(o,a,()=>u(o,a)),w=(o,a,d,p)=>{if(i(a),d===void 0)e(o,a);else if(p&&p.merge){const b=p.merge==="function"?p.merge:Object.assign;b&&r(o[a])&&r(d)?o[a]=b(o[a],d):o[a]=d}else o[a]=d;return o},f=(o,a,d,p)=>{if(!a||!s(o))return o;const b=c(a,p);let h=o;for(let k=0;k<b.length;k++){const y=b[k],j=b[k+1];if(i(y),j===void 0){w(h,y,d,p);break}if(typeof j=="number"&&!Array.isArray(h[y])){h=h[y]=[];continue}s(h[y])||(h[y]={}),h=h[y]}return o};return f.split=c,f.cache=new Map,f.clear=()=>{f.cache=new Map},x=f,x}var ee=Z();const re=G(ee),z=e=>e!==null&&typeof e=="object",T=(e,t,r)=>typeof r.join=="function"?r.join(e):e[0]+t+e[1],te=(e,t,r)=>typeof r.split=="function"?r.split(e):e.split(t),A=(e,t={},r)=>typeof(r==null?void 0:r.isValid)=="function"?r.isValid(e,t):!0,V=e=>z(e)||typeof e=="function",W=(e,t,r={})=>{if(z(r)||(r={default:r}),!V(e))return r.default!==void 0?r.default:e;typeof t=="number"&&(t=String(t));const s=Array.isArray(t),n=typeof t=="string",i=r.separator||".",m=r.joinChar||(typeof i=="string"?i:".");if(!n&&!s)return e;if(e[t]!==void 0)return A(t,e,r)?e[t]:r.default;const S=s?t:te(t,i,r),l=S.length;let u=0;do{let c=S[u];for(typeof c!="string"&&(c=String(c));c.endsWith("\\");)c=T([c.slice(0,-1),S[++u]||""],m,r);if(e[c]!==void 0){if(!A(c,e,r))return r.default;e=e[c]}else{let w=!1,f=u+1;for(;f<l;)if(c=T([c,S[f++]],m,r),w=e[c]!==void 0){if(!A(c,e,r))return r.default;e=e[c],u=f-1;break}if(!w)return r.default}}while(++u<l&&V(e));return u===l?e:r.default};function R(e){return(e==null?void 0:e.label)&&typeof e.label=="string"}function se(e){return(e==null?void 0:e.url)&&typeof e.url=="string"}function O(e,t){for(const r of Object.keys(t))r in e&&typeof t[r]=="object"&&typeof e[r]=="object"?O(e[r],t[r]):(e[r]===void 0||t[r]!==void 0)&&(e[r]=t[r]);return e}function ne(e,t){return e.replaceAll(/{([\s\w.]+)}/g,(r,s)=>{s=s.replaceAll(/\s+/g,"");const n=W(t,s);if(n!==void 0)return typeof n=="function"?n(s):n;if(t.callback){const i=t.callback.call(this,s);if(i!==void 0)return i}return r})}function ie(e,t){if(typeof e=="string"){let r;try{r=JSON.parse(e)}catch(s){throw new Error(`${s} when parsing configuration.`)}return g(r,t)}return g(e,t)}function oe(e,t){let r;try{r=ue(e,t)}catch(s){throw new Error(`${s} when parsing configuration.`)}return g(r,t)}function ae(e){return e==="include"}function ue(e,t){let r=[],s,n,i;const m={tracks:{}};let S;function l(){if(i!==void 0){let u;try{const c=/^json:(.+)/i.exec(i);if(c?u=JSON.parse(c[1]):/^[+-]?[\d.,]+([eE][-+]?\d+)?$/.test(i)?u=Number.parseFloat(i.replaceAll(",","")):u=i,!s)throw new Error(`Error parsing in section ${r.join(" - ")}`);const w=[...r,...s].join(".");if(n==="+="){let f=W(m,w);f?Array.isArray(f)||(f=[f]):f=[],f.push(u),u=f}u==="true"&&(u=!0),u==="false"&&(u=!1),re(m,w,u)}catch{throw new Error(`syntax error${t?` in ${t}`:""}${S?` at line ${S-1}`:""}`)}}}for(const[u,c]of e.split(/\n|\r\n|\r/).entries()){S=u+1;const w=c.replace(/^\s*#.+/,"");let f;if(f=/^\s*\[([^\]]+)/.exec(w))l(),s=void 0,i=void 0,r=f[1].trim().split(/\s*\.\s*/),r.length===1&&r[0].toLowerCase()==="general"&&(r=[]);else if(f=w.match(i===void 0?/^([^+=]+)(\+?=)(.*)/:/^(\S[^+=]+)(\+?=)(.*)/))l(),s=f[1].trim().split(/\s*\.\s*/),[,,n]=f,ae([...r,...s].join("."))&&(n="+="),i=f[3].trim();else if(s!==void 0&&(f=/^\s{0,4}\+\s*(.+)/.exec(w)))l(),n="+=",i=f[1].trim();else if(i!==void 0&&(f=/^\s+(\S.*)/.exec(w))){const o=f[1];i+=i.length?` ${o.trim()}`:o.trim()}else l(),s=void 0,i=void 0}return l(),m}function g(e,t){if(e.tracks&&!Array.isArray(e.tracks))if(R(e.tracks))e.tracks=[e.tracks];else{const s=[];for(const n of Object.keys(e.tracks)){const i=e.tracks[n];R(i)?s.push(i):s.push({label:n,...i})}e.tracks=s}const r=e.trackMetadata;if(r!=null&&r.sources){if(typeof r.sources=="string"&&(r.sources=[r.sources]),se(r.sources)&&(r.sources=[r.sources]),!Array.isArray(r.sources)){const s=[];for(const n of Object.keys(r.sources)){const i=r.sources[n];"name"in i||(i.name=n),s.push(i)}r.sources=s}r.sources=r.sources.map(s=>{if(typeof s=="string"){const n={url:s},i=/\.(\w+)$/.exec(s);return i&&(n.type=i[1].toLowerCase()),n}return s})}if(e.sourceUrl=e.sourceUrl||t,e.sourceUrl.startsWith("/")&&(e.sourceUrl=new URL(e.sourceUrl,window.location.href).href),e.baseUrl=e.baseUrl||new URL(".",e.sourceUrl).href,e.baseUrl.length&&!e.baseUrl.endsWith("/")&&(e.baseUrl+="/"),e.sourceUrl){const s=[];e.tracks&&s.push(...e.tracks),e.stores&&s.push(...Object.values(e.stores)),e.names&&s.push(e.names);for(const n of s)n.baseUrl||(n.baseUrl=e.baseUrl||"/");e.refSeqs&&typeof e.refSeqs=="string"&&(e.refSeqs=new URL(e.refSeqs,e.sourceUrl).href),e.nameUrl&&(e.nameUrl=new URL(e.nameUrl,e.sourceUrl).href)}e.stores=e.stores||{};for(let s of e.tracks||[]){if(s.config){const i=s.config;s.config=void 0,s={...i,...s}}if(s.store)continue;let n;s.type==="FeatureTrack"?n="JBrowse/View/Track/HTMLFeatures":s.type==="ImageTrack"?n="JBrowse/View/Track/FixedImage":s.type==="ImageTrack.Wiggle"?n="JBrowse/View/Track/FixedImage/Wiggle":s.type==="SequenceTrack"?n="JBrowse/View/Track/Sequence":n=D("JBrowse/View/Track",s.type),s.type=n,C(e,s),s.histograms&&(s.histograms.baseUrl||(s.histograms.baseUrl=s.baseUrl),C(e,s.histograms))}return e}function D(e,t){return t?(t.includes("/")||(t=`${e}/${t}`),t=t.replace(/^\//,""),t):""}function fe(e,t){var r,s;return e?!((r=e.type)===null||r===void 0)&&r.includes("/FixedImage")?`JBrowse/Store/TiledImage/Fixed${e.backendVersion===0?"_v0":""}`:/\.jsonz?$/i.test(t)?`JBrowse/Store/SeqFeature/NCList${e.backendVersion===0?"_v0":""}`:/\.bam$/i.test(t)?"JBrowse/Store/SeqFeature/BAM":/\.cram$/i.test(t)?"JBrowse/Store/SeqFeature/CRAM":/\.gff3?$/i.test(t)?"JBrowse/Store/SeqFeature/GFF3":/\.bed$/i.test(t)?"JBrowse/Store/SeqFeature/BED":/\.vcf.b?gz$/i.test(t)?"JBrowse/Store/SeqFeature/VCFTabix":/\.gff3?.b?gz$/i.test(t)?"JBrowse/Store/SeqFeature/GFF3Tabix":/\.bed.b?gz$/i.test(t)?"JBrowse/Store/SeqFeature/BEDTabix":/\.(bw|bigwig)$/i.test(t)?"JBrowse/Store/SeqFeature/BigWig":/\.(bb|bigbed)$/i.test(t)?"JBrowse/Store/SeqFeature/BigBed":/\.(fa|fasta)$/i.test(t)?"JBrowse/Store/SeqFeature/IndexedFasta":/\.(fa|fasta)\.b?gz$/i.test(t)?"JBrowse/Store/SeqFeature/BgzipIndexedFasta":/\.2bit$/i.test(t)?"JBrowse/Store/SeqFeature/TwoBit":!((s=e.type)===null||s===void 0)&&s.endsWith("/Sequence")?"JBrowse/Store/Sequence/StaticChunked":"":""}function C(e,t){var r;const{urlTemplate:s=""}=t,n=t.storeClass?D("JBrowse/Store",t.storeClass):fe(t,s);if(!n){console.warn(`Unable to determine an appropriate data store to use with track '${t.label}', please explicitly specify a storeClass in the configuration.`);return}const i={...t,type:n};i.name=(n==="JBrowse/Store/Sequence/StaticChunked"||n==="JBrowse/Store/Sequence/IndexedFasta"||n==="JBrowse/Store/SeqFeature/IndexedFasta"||n==="JBrowse/Store/SeqFeature/BgzipIndexedFasta"||n==="JBrowse/Store/SeqFeature/TwoBit"||n==="JBrowse/Store/Sequence/TwoBit"||t.useAsRefSeqStore)&&!(!((r=e.stores)===null||r===void 0)&&r.refseqs)?"refseqs":`store${H.objectHash(i)}`,e.stores||(e.stores={}),e.stores[i.name]=i,t.store=i.name}function U(e){return e.uri!==void 0}function v(e){return e.localPath!==void 0}async function me(e={uri:"",locationType:"UriLocation"},t={include:["{dataRoot}/trackList.json","{dataRoot}/tracks.conf"]},r={uri:"",locationType:"UriLocation"}){const s="uri"in e?"uri":"localPath",n=JSON.parse(JSON.stringify(e));let i="";if(U(e)&&(i=e.uri),v(e)&&(i=e.localPath),i.endsWith("/")&&(n[s]=i.slice(0,-1)),U(r)&&r.uri||v(r)&&r.localPath){const S="uri"in r?"uri":"localPath";let l="";U(r)&&(l=r.uri),v(r)&&(l=r.localPath),l.endsWith("/")&&(l=l.slice(0,-1));let u={};for(const c of["jbrowse.conf","jbrowse_conf.json"]){let w=null;try{w=await K({[S]:`${l}/${c}`})}catch{console.error(`tried to access ${l}/${c}, but failed`)}u=B(u,w)||{}}return n[s]&&(u.dataRoot=n[s]),M(u)}const m=g(t,window.location.href);return n[s]&&(m.dataRoot=n[s]),M(m)}async function M(e,t=we){const r=O(structuredClone(t),e);let s=await le(r);return s=B(s,e)||s,$(s,s),he(s),s}async function K(e){const t=await N.openLocation(e).readFile("utf8");return U(e)?P(t,e.uri):v(e)?P(t,e.localPath):P(t)}function P(e,t=""){return e.trim().startsWith("{")?ie(e,t):oe(e,t)}function B(e,t){if(t===null)return null;e===null&&(e={});for(const r of Object.keys(t))if(r==="tracks"&&r in e){const s=e[r]||[],n=t[r]||[];if(Array.isArray(s)&&Array.isArray(n))e[r]=ce(s,n);else throw new Error(`Track config has not been properly regularized: ${s} ${n}`)}else!ye(r)&&r in e&&typeof t[r]=="object"&&typeof e[r]=="object"?e[r]=O(e[r],t[r]):r==="dataRoot"?(e[r]===void 0||e[r]==="data"&&t[r]!==void 0)&&(e[r]=t[r]):(e[r]===void 0||t[r]!==void 0)&&(e[r]=t[r]);return e}function ce(e,t){if(!t.length)return e;const r={};for(const[s,n]of e.entries())n.index=s,r[n.label]=n;for(const s of t){const n=r[s.label];n?B(n,s):e.push(s)}return e}async function le(e){e=structuredClone(e);async function t(r,s){const n=r.sourceUrl||r.baseUrl;if(!n)throw new Error(`Could not determine source URL: ${JSON.stringify(r)}`);const i=B(structuredClone(s),r);if(!i)throw new Error("Problem merging configs");const m=$(de(r.include||[]),i);r.include=void 0;const S=m.map(async u=>{u.cacheBuster=e.cacheBuster;const c=await K({uri:new URL(u.url,n).href,locationType:"UriLocation"});return t(c,i)}),l=await Promise.all(S);for(const u of l)r=B(r,u)||r;return r}return t(e,{})}function de(e){return e?(Array.isArray(e)||(e=[e]),e.map(t=>(typeof t=="string"&&(t={url:t}),"format"in t||(t.format=t.url.endsWith(".conf")?"conf":"JB_json"),t.format==="JB_json"&&!("version"in t)&&(t.version=1),t))):[]}function $(e,t){if(!e)return e;if(Array.isArray(e))for(let r=0;r<e.length;r+=1)e[r]=$(e[r],t);else if(typeof e=="object"){const r=e;for(const s of Object.keys(r))r[s]=$(r[s],t)}else if(typeof e=="string")return ne(e,t);return e}function ye(e){return e==="datasets"}const we={tracks:[],containerID:"GenomeBrowser",dataRoot:"data",show_tracklist:!0,show_nav:!0,show_menu:!0,show_overview:!0,show_fullviewlink:!0,update_browser_title:!0,updateBrowserURL:!0,refSeqs:"{dataRoot}/seq/refSeqs.json",include:["jbrowse.conf","jbrowse_conf.json"],nameUrl:"{dataRoot}/names/root.json",datasets:{_DEFAULT_EXAMPLES:!0,volvox:{url:"?data=sample_data/json/volvox",name:"Volvox Example"},modencode:{url:"?data=sample_data/json/modencode",name:"MODEncode Example"},yeast:{url:"?data=sample_data/json/yeast",name:"Yeast Example"}},highlightSearchedRegions:!1,highResolutionMode:"auto"};function he(e){if(e.tracks||(e.tracks=[]),!e.baseUrl)throw new Error("Must provide a `baseUrl` in configuration")}export{M as createFinalConfig,K as fetchConfigFile,me as fetchJb1,P as parseJb1};
//# sourceMappingURL=jb1ConfigLoad-BtBcVt9D.js.map
