import{u,bf as N,a7 as b,bg as $,r as y,j as s,J as x,c as k,bh as B}from"./rpcWorker-X0469dqW.js";import{B as E}from"./FeatureDetails-CnuNWLxG.js";import{L as h}from"./Link-3UxVx-0U.js";import{n as A}from"./AlignmentsFeatureDetail-CiSu7rNd.js";import"./FormControlLabel-1s92K5sy.js";import"./Checkbox-CZRpP34h.js";async function C({view:e,feature:n}){var a;const{assemblyManager:i}=u.getSession(e),r=n.get("CIGAR"),l=n.get("strand"),f=((a=n.get("tags"))===null||a===void 0?void 0:a.SA)||"",m=n.get("name"),t=N(r,1),g=await i.waitForAssembly(e.assemblyNames[0]);if(!g)throw new Error("assembly not found");const p=b(f,n.id(),l,m,!0),o=n.toJSON();o.clipPos=t,o.strand=1,o.mate={refName:m,start:t,end:t+$(r)};const S=[o,...p];for(const[d,c]of S.entries())c.refName=g.getCanonicalRefName(c.refName)||c.refName,c.syntenyId=d,c.mate.syntenyId=d,c.mate.uniqueId=`${c.uniqueId}_mate`;return S.sort((d,c)=>d.clipPos-c.clipPos),S}const R=y.lazy(()=>import("./BreakendSingleLevelOptionDialog-KgKK-SHY.js").then(function(e){return e.B})),D=y.lazy(()=>import("./BreakendSingleLevelOptionDialog-KgKK-SHY.js").then(function(e){return e.a}));function M({model:e,feature:n}){const{view:a}=e,[i,r]=y.useState(),[l,f]=y.useState();y.useEffect(()=>{(async()=>{try{const t=await C({view:a,feature:new u.SimpleFeature(n)});r(t)}catch(t){f(t),console.error(t)}})()},[n,a]);const m=[];if(i)for(let t=0;t<i.length-1;t++)m.push([i[t],i[t+1]]);return m.length?s.jsxs("div",{children:[s.jsx(x,{children:"Launch split view"}),l?s.jsx(k.ErrorMessage,{error:l}):null,s.jsx("ul",{children:m.map((t,g)=>{const[p,o]=t;return s.jsxs("li",{children:[p.refName,":",u.toLocale(p.strand===1?p.end:p.start)," ->"," ",o.refName,":",u.toLocale(o.strand===1?o.start:o.end)," ",s.jsx(V,{model:e,f1:p,f2:o})," ",s.jsx(F,{model:e,f1:p,f2:o})]},`${JSON.stringify(t)}-${g}`)})})]}):null}function V({model:e,f1:n,f2:a}){return s.jsx(h,{href:"#",onClick:i=>{i.preventDefault();const r=u.getSession(e);r.queueDialog(l=>[R,{handleClose:l,session:r,feature:new u.SimpleFeature({...n,mate:a}),view:e.view,assemblyName:e.view.displayedRegions[0].assemblyName}])},children:"(top/bottom)"})}function F({model:e,f1:n,f2:a}){return s.jsx(h,{href:"#",onClick:i=>{i.preventDefault();const r=u.getSession(e);r.queueDialog(l=>[D,{handleClose:l,session:r,feature:new u.SimpleFeature({...n,mate:a}),view:e.view,assemblyName:e.view.displayedRegions[0].assemblyName}])},children:"(single row)"})}function I({tag:e,model:n}){return s.jsxs("div",{children:[s.jsx(x,{children:"List of supplementary alignment locations"}),s.jsx("ul",{children:e.split(";").filter(a=>!!a).map((a,i)=>{const[r,l,f,m]=a.split(","),t=B(m),g=Math.floor(t/5),p=+l,o=+l+t,S=p-g,d=o+g,c=`${r}:${Math.max(1,S)}-${d}`,w=p.toLocaleString("en-US"),j=o.toLocaleString("en-US"),v=`${r}:${w}-${j} (${f}) [${t}bp]`;return s.jsx("li",{children:s.jsx(h,{href:"#",onClick:async L=>{L.preventDefault(),A(c,n)},children:v})},`${c}-${i}`)})})]})}function U(e){const{model:n,tag:a,feature:i}=e,r=u.getSession(n),{pluginManager:l}=u.getEnv(r);let f=!1;try{f=!!l.getViewType("BreakpointSplitView")}catch{}return s.jsxs(E,{...e,title:"Supplementary alignments",children:[s.jsx(I,{model:n,tag:a}),f?s.jsx(M,{model:n,feature:i}):null]})}export{U as default};
//# sourceMappingURL=SupplementaryAlignments-sqFqV06z.js.map
