import{a as D,j as n,u as g,m as N,az as C,o as P,aA as T}from"./index-DUxFddIG.js";const $=N()(()=>({td:{whiteSpace:"nowrap"},table:{width:"100%",tableLayout:"auto"}})),R=(t=0)=>+t.toFixed(1),p=(t,e=1)=>`${R(t/(e||1)*100)}%`;function w(t,e){var o;if(!(!t.startsWith("mod_")&&!t.startsWith("nonmod_")))return t.startsWith("nonmod_")?"blue":(o=e.visibleModifications.get(t.replace(/^mod_/,"")))===null||o===void 0?void 0:o.color}function W(t){return t.startsWith("mod_")||t.startsWith("nonmod_")}function j(t){return t.replace(/^(mod_|nonmod_)/,"")}function y(t){const e=t[-1]?`${t[-1]}(-)`:"",o=t[1]?`${t[1]}(+)`:"";return e+o}function _(t){return t!=="depth"&&t!=="skip"}function B(t,e){if(t.startsWith("nonmod_"))return`Unmodified ${t.replace("nonmod_","")}`;const i=j(t);return e.visibleModifications.get(i)?C(i):t.toUpperCase()}function U(t,e){if(t.startsWith("nonmod_"))return`Unmodified ${t.replace("nonmod_","")}`;const i=j(t);return e.visibleModifications.get(i)?C(i):t.toUpperCase()}function M({base:t,model:e}){const o=w(t,e);return o?n.jsx("div",{style:{width:10,height:10,background:o}}):null}function L(){return n.jsx("thead",{children:n.jsxs("tr",{children:[n.jsx("th",{}),n.jsx("th",{children:"Base"}),n.jsx("th",{children:"Count"}),n.jsx("th",{children:"% of Reads"}),n.jsx("th",{children:"Strands"}),n.jsx("th",{children:"Avg Prob"})]})})}function k({readsCounted:t}){return n.jsxs("tr",{children:[n.jsx("td",{}),n.jsx("td",{children:"Total"}),n.jsx("td",{children:t}),n.jsx("td",{children:" "}),n.jsx("td",{children:" "}),n.jsx("td",{children:" "})]})}function E({referenceBase:t,reference:e,readsCounted:o}){return n.jsxs("tr",{children:[n.jsx("td",{}),n.jsxs("td",{children:["REF ",t?`(${t.toUpperCase()})`:""]}),n.jsx("td",{children:e.entryDepth}),n.jsx("td",{children:p(e.entryDepth,o)}),n.jsx("td",{children:y(e)}),n.jsx("td",{children:" "})]})}function O({base:t,score:e,readsCounted:o,model:i,tdClass:d,rowKey:s}){return n.jsxs("tr",{children:[n.jsx("td",{children:n.jsx(M,{model:i,base:t})}),n.jsx("td",{children:U(t,i)}),n.jsx("td",{className:d,children:e.entryDepth}),n.jsx("td",{children:_(t)?p(e.entryDepth,o):"---"}),n.jsx("td",{children:y(e)}),n.jsx("td",{children:e.avgProbability!==void 0?p(e.avgProbability):""})]},s)}function b({base:t,score:e,isMod:o,readsCounted:i,model:d,tdClass:s,rowKey:c}){return n.jsxs("tr",{children:[n.jsx("td",{children:n.jsx(M,{model:d,base:t})}),n.jsx("td",{children:o?B(t,d):t.toUpperCase()}),n.jsx("td",{className:s,children:e.entryDepth}),n.jsx("td",{children:_(t)?p(e.entryDepth,i):"---"}),n.jsx("td",{children:y(e)}),n.jsx("td",{children:e.avgProbability!==void 0?p(e.avgProbability):""})]},c)}function A({info:t,readsCounted:e,model:o,tdClass:i}){const d={};for(const[s,c]of Object.entries(t))for(const[a,r]of Object.entries(c))if(a.startsWith("nonmod_")){const f=j(a),u=o.visibleModifications.get(f),m=(u==null?void 0:u.base)||"X",h=`${s}_nonmod_${m}`;d[h]||(d[h]={base:`nonmod_${m}`,score:{entryDepth:0,1:0,"-1":0,avgProbability:0},isNonmod:!0});const l=d[h];if(l.score.entryDepth+=r.entryDepth,l.score[1]+=r[1],l.score[-1]+=r[-1],r.avgProbability!==void 0){const S=l.score.avgProbability||0,v=l.score.entryDepth-r.entryDepth;l.score.avgProbability=v>0?(S*v+r.avgProbability*r.entryDepth)/l.score.entryDepth:r.avgProbability}}else d[`${s}_${a}`]={base:a,score:{...r},isNonmod:!1};return n.jsx(n.Fragment,{children:Object.entries(d).map(([s,{base:c,score:a,isNonmod:r}])=>{var x;const f=j(c),u=W(c)||r,m=!r&&u&&((x=o.simplexModifications)===null||x===void 0?void 0:x.has(f)),h=a[1]||0,l=a[-1]||0;return r?n.jsx(b,{base:c,score:a,isMod:!0,isSimplex:!1,readsCounted:e,model:o,tdClass:i,rowKey:s},s):u&&!m&&(h>0||l>0)?n.jsx(O,{base:c,score:a,posStrandCount:h,negStrandCount:l,readsCounted:e,model:o,tdClass:i,rowKey:s},s):n.jsx(b,{base:c,score:a,isMod:u,isSimplex:m,readsCounted:e,model:o,tdClass:i,rowKey:s},s)})})}const F=D.forwardRef(function(e,o){const{feature:i,model:d}=e,{classes:s}=$(),c=i.get("start")+1,a=i.get("end"),r=i.get("refName"),{refbase:x,readsCounted:f,depth:u,ref:m,...h}=i.get("snpinfo");return n.jsx("div",{ref:o,children:n.jsxs("table",{children:[n.jsx("caption",{children:[r,c===a?g.toLocale(c):`${g.toLocale(c)}..${g.toLocale(a)}`].filter(l=>!!l).join(":")}),n.jsx(L,{}),n.jsxs("tbody",{children:[n.jsx(k,{readsCounted:f}),n.jsx(E,{referenceBase:x,reference:m,readsCounted:f}),n.jsx(A,{info:h,readsCounted:f,model:d,tdClass:s.td})]})]})})}),z=P(function(t){const{model:e}=t,{featureUnderMouse:o}=e;return o&&o.get("type")==="skip"?null:n.jsx(T,{TooltipContents:F,...t})});export{z as default};
//# sourceMappingURL=Tooltip-C2DQA5xM.js.map
